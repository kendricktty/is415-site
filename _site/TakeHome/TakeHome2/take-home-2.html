<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kendrick Teo">
<meta name="dcterms.date" content="2024-09-23">

<title>TH2: Application of Geospatial Analysis Methods to Discover Thailand Drug Abuse at the Province Level – IS415 - Kendrick</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">IS415 - Kendrick</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About me</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercises" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">In-Class Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercises">    
        <li>
    <a class="dropdown-item" href="../../InClass/ICE1/in-class-1.html">
 <span class="dropdown-text">CE1: Geospatial Data Science</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClass/ICE2/in-class-2.html">
 <span class="dropdown-text">CE2: Working with Master Plan Planning Subzone Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClass/ICE3/in-class-3.html">
 <span class="dropdown-text">CE3: Spatial Point Patterns Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClass/ICE4/in-class-4.html">
 <span class="dropdown-text">CE4/H4: Spatial-Temporal Point Patterns Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClass/ICE5/in-class-5.html">
 <span class="dropdown-text">CE5: Geographically-weighted statistics with gwModel</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClass/ICE5/in-class-6.html">
 <span class="dropdown-text">CE6: Measures of Spatial Autocorrelation</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercises" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hands-On Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercises">    
        <li>
    <a class="dropdown-item" href="../../HandsOn/Hands-on_Ex01/hands-on-1.html">
 <span class="dropdown-text">H1: Geospatial Data Wrangling with R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsOn/Hands-on_Ex02/hands-on-2.html">
 <span class="dropdown-text">H2: Thematic Mapping and Geospatial visualisation with R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsOn/Hands-on_Ex03/hands-on-3.html">
 <span class="dropdown-text">H3: Spatial Point Patterns Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClass/ICE4/in-class-4.html">
 <span class="dropdown-text">CE4/H4: Spatial-Temporal Point Patterns Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsOn/Hands-on_Ex05/hands-on-5.html">
 <span class="dropdown-text">H5: Spatial Weights and Appliations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsOn/hands-on-6.html">
 <span class="dropdown-text">HX6: Spatial Autocorrelation</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercises" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Take-home Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercises">    
        <li>
    <a class="dropdown-item" href="../../TakeHome/TakeHome1/take-home-1.html">
 <span class="dropdown-text">TH1: Geospatial Analytics for Social Good</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../TakeHome/TakeHome2/take-home-2.html">
 <span class="dropdown-text">TH2: Application of Geospatial Analysis Methods to Discover Thailand Drug Abuse at the Province Level</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#th2.1-setting-the-scene" id="toc-th2.1-setting-the-scene" class="nav-link active" data-scroll-target="#th2.1-setting-the-scene">TH2.1 Setting the Scene</a></li>
  <li><a href="#th2.2-the-drug-problem-in-thailand" id="toc-th2.2-the-drug-problem-in-thailand" class="nav-link" data-scroll-target="#th2.2-the-drug-problem-in-thailand">TH2.2 The Drug Problem in Thailand</a></li>
  <li><a href="#th2.3-importing-data-and-r-packages" id="toc-th2.3-importing-data-and-r-packages" class="nav-link" data-scroll-target="#th2.3-importing-data-and-r-packages">TH2.3 Importing data and R packages</a>
  <ul class="collapse">
  <li><a href="#th2.3.1-data-cleansing" id="toc-th2.3.1-data-cleansing" class="nav-link" data-scroll-target="#th2.3.1-data-cleansing">TH2.3.1 Data Cleansing</a></li>
  </ul></li>
  <li><a href="#th2.4-exploratory-data-analysis" id="toc-th2.4-exploratory-data-analysis" class="nav-link" data-scroll-target="#th2.4-exploratory-data-analysis">TH2.4 Exploratory Data Analysis</a>
  <ul class="collapse">
  <li><a href="#th2.4.1-plotting-changes-in-drug-trafficking-cases-by-time" id="toc-th2.4.1-plotting-changes-in-drug-trafficking-cases-by-time" class="nav-link" data-scroll-target="#th2.4.1-plotting-changes-in-drug-trafficking-cases-by-time">TH2.4.1 Plotting changes in drug trafficking cases by time</a></li>
  <li><a href="#th2.4.2-plotting-changes-in-drug-use-cases-by-time" id="toc-th2.4.2-plotting-changes-in-drug-use-cases-by-time" class="nav-link" data-scroll-target="#th2.4.2-plotting-changes-in-drug-use-cases-by-time">TH2.4.2 Plotting changes in drug use cases by time</a></li>
  </ul></li>
  <li><a href="#th2.4.3-creating-filtered-table-for-2021-observations" id="toc-th2.4.3-creating-filtered-table-for-2021-observations" class="nav-link" data-scroll-target="#th2.4.3-creating-filtered-table-for-2021-observations">TH2.4.3 Creating filtered table for 2021 observations</a></li>
  <li><a href="#th2.5-deriving-global-measures-of-spatial-autocorrelation" id="toc-th2.5-deriving-global-measures-of-spatial-autocorrelation" class="nav-link" data-scroll-target="#th2.5-deriving-global-measures-of-spatial-autocorrelation">TH2.5 Deriving Global Measures of Spatial Autocorrelation</a>
  <ul class="collapse">
  <li><a href="#th2.5.1-data-preparation---spatial-weights" id="toc-th2.5.1-data-preparation---spatial-weights" class="nav-link" data-scroll-target="#th2.5.1-data-preparation---spatial-weights">TH2.5.1 Data Preparation - Spatial Weights</a></li>
  <li><a href="#th2.5.2-morans-i" id="toc-th2.5.2-morans-i" class="nav-link" data-scroll-target="#th2.5.2-morans-i">TH2.5.2 Moran’s I</a></li>
  </ul></li>
  <li><a href="#th2.6-gearys-c" id="toc-th2.6-gearys-c" class="nav-link" data-scroll-target="#th2.6-gearys-c">TH2.6 Geary’s C</a>
  <ul class="collapse">
  <li><a href="#th2.6.1-gearys-c-on-drug_use-statistics" id="toc-th2.6.1-gearys-c-on-drug_use-statistics" class="nav-link" data-scroll-target="#th2.6.1-gearys-c-on-drug_use-statistics">TH2.6.1 Geary’s C on <code>drug_use</code> statistics</a></li>
  <li><a href="#th2.6.2-gearys-c-on-drug_trafficking-statistics" id="toc-th2.6.2-gearys-c-on-drug_trafficking-statistics" class="nav-link" data-scroll-target="#th2.6.2-gearys-c-on-drug_trafficking-statistics">TH2.6.2 Geary’s C on <code>drug_trafficking</code> statistics</a></li>
  </ul></li>
  <li><a href="#th2.7-deriving-local-measures-of-spatial-autocorrelation" id="toc-th2.7-deriving-local-measures-of-spatial-autocorrelation" class="nav-link" data-scroll-target="#th2.7-deriving-local-measures-of-spatial-autocorrelation">TH2.7 Deriving Local Measures of Spatial Autocorrelation</a>
  <ul class="collapse">
  <li><a href="#th2.7.1-mapping-local-morans-i-statistics-for-drug_use-cases" id="toc-th2.7.1-mapping-local-morans-i-statistics-for-drug_use-cases" class="nav-link" data-scroll-target="#th2.7.1-mapping-local-morans-i-statistics-for-drug_use-cases">TH2.7.1 Mapping Local Moran’s I statistics for <code>drug_use</code> cases</a></li>
  <li><a href="#th2.7.2-mapping-local-morans-i-statistics-for-drug_trafficking-cases" id="toc-th2.7.2-mapping-local-morans-i-statistics-for-drug_trafficking-cases" class="nav-link" data-scroll-target="#th2.7.2-mapping-local-morans-i-statistics-for-drug_trafficking-cases">TH2.7.2 Mapping Local Moran’s I statistics for <code>drug_trafficking</code> cases</a></li>
  <li><a href="#th2.7.3-performing-local-morans-i-monte-carlo-test-for-drug_use-cases" id="toc-th2.7.3-performing-local-morans-i-monte-carlo-test-for-drug_use-cases" class="nav-link" data-scroll-target="#th2.7.3-performing-local-morans-i-monte-carlo-test-for-drug_use-cases">TH2.7.3 Performing Local Moran’s I Monte Carlo test for <code>drug_use</code> cases</a></li>
  <li><a href="#th2.7.4-performing-local-morans-i-monte-carlo-test-for-drug_trafficking-cases" id="toc-th2.7.4-performing-local-morans-i-monte-carlo-test-for-drug_trafficking-cases" class="nav-link" data-scroll-target="#th2.7.4-performing-local-morans-i-monte-carlo-test-for-drug_trafficking-cases">TH2.7.4 Performing Local Moran’s I Monte Carlo test for <code>drug_trafficking</code> cases</a></li>
  </ul></li>
  <li><a href="#th2.7.5-drawing-local-morans-i-scatterplots" id="toc-th2.7.5-drawing-local-morans-i-scatterplots" class="nav-link" data-scroll-target="#th2.7.5-drawing-local-morans-i-scatterplots">TH2.7.5 Drawing local Moran’s I scatterplots</a>
  <ul class="collapse">
  <li><a href="#th2.7.6-creating-lisa-cluster-map" id="toc-th2.7.6-creating-lisa-cluster-map" class="nav-link" data-scroll-target="#th2.7.6-creating-lisa-cluster-map">TH2.7.6 Creating LISA cluster map</a></li>
  </ul></li>
  <li><a href="#th2.8-using-local-gi-statistics-to-perform-hot-and-cold-spot-analysis" id="toc-th2.8-using-local-gi-statistics-to-perform-hot-and-cold-spot-analysis" class="nav-link" data-scroll-target="#th2.8-using-local-gi-statistics-to-perform-hot-and-cold-spot-analysis">TH2.8 Using Local Gi* statistics to perform hot and cold spot analysis</a>
  <ul class="collapse">
  <li><a href="#th2.8.1-drug_use-dataset" id="toc-th2.8.1-drug_use-dataset" class="nav-link" data-scroll-target="#th2.8.1-drug_use-dataset">TH2.8.1 <code>drug_use</code> dataset</a></li>
  <li><a href="#th2.8.2-drug_trafficking-dataset" id="toc-th2.8.2-drug_trafficking-dataset" class="nav-link" data-scroll-target="#th2.8.2-drug_trafficking-dataset">TH2.8.2 <code>drug_trafficking</code> dataset</a></li>
  </ul></li>
  <li><a href="#th2.9-emerging-hotspot-analysis" id="toc-th2.9-emerging-hotspot-analysis" class="nav-link" data-scroll-target="#th2.9-emerging-hotspot-analysis">TH2.9 Emerging Hotspot Analysis</a>
  <ul class="collapse">
  <li><a href="#th2.9.1-data-wrangling-for-ehsa" id="toc-th2.9.1-data-wrangling-for-ehsa" class="nav-link" data-scroll-target="#th2.9.1-data-wrangling-for-ehsa">TH2.9.1 Data wrangling for EHSA</a></li>
  <li><a href="#th2.9.2-performing-ehsa" id="toc-th2.9.2-performing-ehsa" class="nav-link" data-scroll-target="#th2.9.2-performing-ehsa">TH2.9.2 Performing EHSA</a></li>
  <li><a href="#th2.9.3-visualising-distribution-of-ehsa-classes" id="toc-th2.9.3-visualising-distribution-of-ehsa-classes" class="nav-link" data-scroll-target="#th2.9.3-visualising-distribution-of-ehsa-classes">TH2.9.3 Visualising Distribution of EHSA classes</a></li>
  <li><a href="#th2.9.4-visualising-ehsa-maps" id="toc-th2.9.4-visualising-ehsa-maps" class="nav-link" data-scroll-target="#th2.9.4-visualising-ehsa-maps">TH2.9.4 Visualising EHSA Maps</a></li>
  </ul></li>
  <li><a href="#th2.10-local-gi-and-mann-kendall-tests" id="toc-th2.10-local-gi-and-mann-kendall-tests" class="nav-link" data-scroll-target="#th2.10-local-gi-and-mann-kendall-tests">TH2.10 Local Gi* and Mann-Kendall Tests</a></li>
  <li><a href="#th2.11-conclusion" id="toc-th2.11-conclusion" class="nav-link" data-scroll-target="#th2.11-conclusion">TH2.11 Conclusion</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">TH2: Application of Geospatial Analysis Methods to Discover Thailand Drug Abuse at the Province Level</h1>
<p class="subtitle lead">Take Home Exercise 2</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Kendrick Teo </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 23, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">October 4, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="th2.1-setting-the-scene" class="level2">
<h2 class="anchored" data-anchor-id="th2.1-setting-the-scene">TH2.1 Setting the Scene</h2>
<p>Drug abuse brings with it significant negative health, financial and social consequences. Yet, illicit drug consumption remains highly prevalent and continues to be a growing problem worldwide. The UNODC has reported an increase in the number of people using illicit drugs to 292 million people worldwide in the decade leading up to 2022. Of these, 228 million people consumed cannabis, 60 million people consumed opiods, 30 million used amphetamines, 23 million used cocaine and 20 million took ecstasy. Further, they found an <strong>increase in overdose deaths following the emergence of nitazenes</strong>, which is a group of synthetic opioids potentially more dangerous than fentanyl – in several high-income countries. (World Drug Day Report Highlights Spike in Drug Use, Increased Trafficking | UN News, 2024).</p>
<p>The aim of today’s study is to discover:</p>
<ul>
<li>How the trend of drug offences in Thailand varied over the past 6 years,</li>
<li>If the key indicators of drug abuse and trafficking in Thailand are independent from space,</li>
<li>If the indicators of drug abuse and trafficking are indeed spatially-dependent, and if so, where the clusters, outliers and hotspots are located.</li>
</ul>
</section>
<section id="th2.2-the-drug-problem-in-thailand" class="level2">
<h2 class="anchored" data-anchor-id="th2.2-the-drug-problem-in-thailand">TH2.2 The Drug Problem in Thailand</h2>
<p><strong><a href="https://en.wikipedia.org/wiki/Thailand">Thailand</a></strong> (2024 GDP per capita - PPP: $23,401; Gini coefficient: 35.1 - <span style="color:orange;">medium</span>; HDI: 0.083 - <span style="color:darkgreen;">very high</span>) (International Monetary Fund, 2024) (World Bank, n.d.) (United Nations Development Programme, 2024) is located in close proximity to the <a href="https://en.wikipedia.org/wiki/Golden_Triangle_(Southeast_Asia)">Golden Triangle</a>, which comprises the northern part of the country along with northeastern Myanmar and northern Laos. In 2021, its drug trafficking situation remained critical, with 337,186 drug cases in total. While seizures of ketamine decreased between 2020 and 2021, seizures of methamphetamine, ice and heroin increased in the same period, with heroin seeing the biggest increase from 1873kg in 2020 to 4520kg in 2021 (Kanato et al., 2022). Considering that the <em>COVID-19 pandemic</em> - which caused a global economic depression among other socio-economic effects - occurred around this time, it can be theorised that those who encountered economic hardship as a result of the pandemic might turn to drug trafficking to support themselves and their families.</p>
<p>The maximum penalty for drug trafficking in Thailand, as is neighbouring Laos, Malaysia and Singapore, is <a href="https://en.wikipedia.org/wiki/Capital_punishment_for_drug_trafficking">death</a> (Thailand, n.d.). Despite this, smugglers have innovated on new routes through the northern and northeastern borders of the country, and even go so far as to hide shipments in cargo vessels bound for the likes of Singapore, New Zealand, Australia and South Korea. 575 smuggling cases by sea occurred in 2021, in which 4554kg of heroin, 2.4 times more than the previous year, were seized (Kanato et al., 2022).</p>
<p>Drug <em>use</em> in the country is as problematic. In 2018, 39% of Thais aged between 15 and 24 were involved in illicit drugs. Of youth aged between 15 and 19, there are 300000 who need treatment, and a significant majority attend vocational schools (as opposed to grade schools). Kongjareon et al.&nbsp;(2022) found in a study of 638 students in four vocational schools, that 11.3% reported poly-drug use. Among LGBT students this figure was 20.2%, and among hetrosexual students 9.8%. Factors contributing to the former’s use of drugs include, among other things, counselling needs, intoxicated sex and GPA.</p>
</section>
<section id="th2.3-importing-data-and-r-packages" class="level2">
<h2 class="anchored" data-anchor-id="th2.3-importing-data-and-r-packages">TH2.3 Importing data and R packages</h2>
<p>The <code>R</code> packages we will use today are:</p>
<ul>
<li><code>sf</code></li>
<li><code>Kendall</code> for computing Kendall rank correction and Mann-Kendall trend test</li>
<li><code>tmap</code></li>
<li><code>spatstat</code></li>
<li><code>sfdep</code> and <code>spdep</code> for measures of spatial autocorrelation, and</li>
<li><code>sparr</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(sf, raster, spatstat, sfdep, spdep, sparr, tmap, tidyverse, gridExtra, zoo, Kendall)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will be examining a dataset of drug offences in Thailand between 2017 and 2022 retrieved from Kaggle, superimposed against the provincial boundaries of the country. This dataset encompasses a number of drug offence categories, from usage to trafficking and posession and export.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>thailand <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn=</span><span class="st">"data/geospatial"</span>, <span class="at">layer=</span><span class="st">"tha_admbnda_adm1_rtsd_20220121"</span>) <span class="sc">%&gt;%</span> <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">4326</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `tha_admbnda_adm1_rtsd_20220121' from data source 
  `/Users/kendricktty/Gits/smu_cs/is415-site/TakeHome/TakeHome2/data/geospatial' 
  using driver `ESRI Shapefile'
Simple feature collection with 77 features and 16 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 97.34336 ymin: 5.613038 xmax: 105.637 ymax: 20.46507
Geodetic CRS:  WGS 84</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>thailand</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 77 features and 16 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 97.34336 ymin: 5.613038 xmax: 105.637 ymax: 20.46507
Geodetic CRS:  WGS 84
First 10 features:
   Shape_Leng Shape_Area                  ADM1_EN       ADM1_TH ADM1_PCODE
1    2.417227 0.13133873                  Bangkok  กรุงเทพมหานคร       TH10
2    1.695100 0.07926199             Samut Prakan    สมุทรปราการ       TH11
3    1.251111 0.05323766               Nonthaburi         นนทบุรี       TH12
4    1.884945 0.12698345             Pathum Thani        ปทุมธานี       TH13
5    3.041716 0.21393797 Phra Nakhon Si Ayutthaya พระนครศรีอยุธยา       TH14
6    1.739908 0.07920961                Ang Thong        อ่างทอง       TH15
7    5.693342 0.54578838                 Lop Buri          ลพบุรี       TH16
8    1.778326 0.06872655                Sing Buri         สิงห์บุรี       TH17
9    2.896316 0.20907828                 Chai Nat         ชัยนาท       TH18
10   4.766446 0.29208711                 Saraburi         สระบุรี       TH19
   ADM1_REF ADM1ALT1EN ADM1ALT2EN ADM1ALT1TH ADM1ALT2TH  ADM0_EN   ADM0_TH
1      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
2      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
3      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
4      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
5      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
6      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
7      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
8      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
9      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
10     &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
   ADM0_PCODE       date    validOn validTo                       geometry
1          TH 2019-02-18 2022-01-22    &lt;NA&gt; MULTIPOLYGON (((100.6139 13...
2          TH 2019-02-18 2022-01-22    &lt;NA&gt; MULTIPOLYGON (((100.7306 13...
3          TH 2019-02-18 2022-01-22    &lt;NA&gt; MULTIPOLYGON (((100.3415 14...
4          TH 2019-02-18 2022-01-22    &lt;NA&gt; MULTIPOLYGON (((100.8916 14...
5          TH 2019-02-18 2022-01-22    &lt;NA&gt; MULTIPOLYGON (((100.5131 14...
6          TH 2019-02-18 2022-01-22    &lt;NA&gt; MULTIPOLYGON (((100.3332 14...
7          TH 2019-02-18 2022-01-22    &lt;NA&gt; MULTIPOLYGON (((101.3453 15...
8          TH 2019-02-18 2022-01-22    &lt;NA&gt; MULTIPOLYGON (((100.3691 15...
9          TH 2019-02-18 2022-01-22    &lt;NA&gt; MULTIPOLYGON (((100.1199 15...
10         TH 2019-02-18 2022-01-22    &lt;NA&gt; MULTIPOLYGON (((101.3994 15...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>thailand_drug <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/thai_drug_offenses_2017_2022.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 7392 Columns: 5
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (3): types_of_drug_offenses, province_th, province_en
dbl (2): fiscal_year, no_cases

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>thailand_drug</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7,392 × 5
   fiscal_year types_of_drug_offenses no_cases province_th   province_en        
         &lt;dbl&gt; &lt;chr&gt;                     &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;              
 1        2017 drug_use_cases            11871 กรุงเทพมหานคร  Bangkok            
 2        2017 drug_use_cases              200 ชัยนาท         Chai Nat           
 3        2017 drug_use_cases              553 นนทบุรี         Nonthaburi         
 4        2017 drug_use_cases              450 ปทุมธานี        Pathum Thani       
 5        2017 drug_use_cases              378 พระนครศรีอยุธยา Phra Nakhon Si Ayu…
 6        2017 drug_use_cases              727 ลพบุรี          Loburi             
 7        2017 drug_use_cases              820 สมุทรปราการ    Samut Prakan       
 8        2017 drug_use_cases               69 สระบุรี         Saraburi           
 9        2017 drug_use_cases              127 สิงห์บุรี         Sing Buri          
10        2017 drug_use_cases              208 อ่างทอง        Ang Thong          
# ℹ 7,382 more rows</code></pre>
</div>
</div>
<section id="th2.3.1-data-cleansing" class="level3">
<h3 class="anchored" data-anchor-id="th2.3.1-data-cleansing">TH2.3.1 Data Cleansing</h3>
<p>There are discrepancies in the spelling of the province names between the shapefile and drug offence data, and R does not appear to support table joins if the values are not in English (which means a join by their Thai names is not possible). The only way to ensure all data is accounted for correctly later is to update the names of provinces in the drug offence table so that they match those in the shapefile - otherwise, the provinces with name mismatches will be reflected as missing data. Luckily, only 2 provinces have name mismatches: Bueng Kan and Lop Buri.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>thailand_drug <span class="ot">&lt;-</span> thailand_drug <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">province_en =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    province_en <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"buogkan"</span>) <span class="sc">~</span> <span class="st">"Bueng Kan"</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    province_en <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Loburi"</span>) <span class="sc">~</span> <span class="st">"Lop Buri"</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> province_en</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="th2.4-exploratory-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="th2.4-exploratory-data-analysis">TH2.4 Exploratory Data Analysis</h2>
<p>The code chunk below prints the total number of each unique type of drug offence cases.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>thailand_drug_analysis <span class="ot">&lt;-</span> thailand_drug <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(types_of_drug_offenses) <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_cases =</span> <span class="fu">sum</span>(no_cases)) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>thailand_drug_analysis</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 2
   types_of_drug_offenses                                 total_cases
   &lt;chr&gt;                                                        &lt;dbl&gt;
 1 conspiracy_cases                                               920
 2 drug_use_cases                                              915529
 3 export_cases                                                    84
 4 import_cases                                                   860
 5 possession_cases                                            538893
 6 possession_with_intent_to_distribute_cases                  341283
 7 production_cases                                             56892
 8 suspects_in_conspiracy_cases                                  2332
 9 suspects_in_drug_use_cases                                  930768
10 suspects_in_export_cases                                       102
11 suspects_in_import_cases                                      1066
12 suspects_in_possession_cases                                566999
13 suspects_in_possession_with_intent_to_distribute_cases      386946
14 suspects_in_production_cases                                 66247
15 suspects_in_trafficking_cases                                79997
16 trafficking_cases                                            68379</code></pre>
</div>
</div>
<p>There are a total of 8 different types of cases, with another 8 unique values dedicated to suspected instances of cases.</p>
<p>We are particularly interested in drug use and trafficking cases, so we will now attempt to plot the changes in the number of each type of case between 2017 and 2022. This analysis will help us select study periods to analyse later.</p>
<section id="th2.4.1-plotting-changes-in-drug-trafficking-cases-by-time" class="level3">
<h3 class="anchored" data-anchor-id="th2.4.1-plotting-changes-in-drug-trafficking-cases-by-time">TH2.4.1 Plotting changes in drug trafficking cases by time</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>thailand_drug_trafficking <span class="ot">&lt;-</span> thailand_drug <span class="sc">%&gt;%</span> <span class="fu">filter</span>(types_of_drug_offenses <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"trafficking_cases"</span>, <span class="st">"suspects_in_trafficking_cases"</span>, <span class="st">"possession_with_intent_to_distribute_cases"</span>, <span class="st">"suspects_in_possession_with_intent_to_distribute_cases"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fiscal_year) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_cases =</span> <span class="fu">sum</span>(no_cases[types_of_drug_offenses <span class="sc">==</span> <span class="st">"trafficking_cases"</span>]),</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_suspect_cases =</span> <span class="fu">sum</span>(no_cases[types_of_drug_offenses <span class="sc">==</span> <span class="st">"suspects_in_trafficking_cases"</span>]),</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_posession_intent_cases =</span> <span class="fu">sum</span>(no_cases[types_of_drug_offenses <span class="sc">==</span> <span class="st">"possession_with_intent_to_distribute_cases"</span>]),</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_suspect_posession_intent_cases =</span> <span class="fu">sum</span>(no_cases[types_of_drug_offenses <span class="sc">==</span> <span class="st">"suspects_in_possession_with_intent_to_distribute_cases"</span>])) <span class="sc">%&gt;%</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>thailand_drug_trafficking</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  fiscal_year total_cases total_suspect_cases total_posession_intent_cases
        &lt;dbl&gt;       &lt;dbl&gt;               &lt;dbl&gt;                        &lt;dbl&gt;
1        2017       13089               15603                        55644
2        2018       12034               14630                        64205
3        2019       11366               13498                        63194
4        2020       12248               13918                        67014
5        2021       10847               12395                        68681
6        2022        8795                9953                        22545
# ℹ 1 more variable: total_suspect_posession_intent_cases &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> thailand_drug_trafficking, <span class="fu">aes</span>(<span class="at">x =</span> fiscal_year)) <span class="sc">+</span>     </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> total_cases, <span class="at">color =</span> <span class="st">"trafficking_cases"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> total_cases, <span class="at">color =</span> <span class="st">"trafficking_cases"</span>), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> total_suspect_cases, <span class="at">color =</span> <span class="st">"suspects_in_trafficking_cases"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> total_suspect_cases, <span class="at">color =</span> <span class="st">"suspects_in_trafficking_cases"</span>), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Trafficking Cases and Suspects"</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Number of cases"</span>) <span class="sc">+</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"trafficking_cases"</span> <span class="ot">=</span> <span class="st">"purple3"</span>, <span class="st">"suspects_in_trafficking_cases"</span> <span class="ot">=</span> <span class="st">"plum"</span>)) <span class="sc">+</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Legend"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home-2_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> thailand_drug_trafficking, <span class="fu">aes</span>(<span class="at">x =</span> fiscal_year)) <span class="sc">+</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> total_posession_intent_cases, <span class="at">color =</span> <span class="st">"possession_with_intent_to_distribute_cases"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> total_posession_intent_cases, <span class="at">color =</span> <span class="st">"possession_with_intent_to_distribute_cases"</span>), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> total_suspect_posession_intent_cases, <span class="at">color =</span> <span class="st">"suspects_in_possession_with_intent_to_distribute_cases"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> total_suspect_posession_intent_cases, <span class="at">color =</span> <span class="st">"suspects_in_possession_with_intent_to_distribute_cases"</span>), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Possession with Intent to Distribute Cases and Suspects"</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Number of cases"</span>) <span class="sc">+</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"possession_with_intent_to_distribute_cases"</span> <span class="ot">=</span> <span class="st">"black"</span>, </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"suspects_in_possession_with_intent_to_distribute_cases"</span> <span class="ot">=</span> <span class="st">"gray"</span>)) <span class="sc">+</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Legend"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home-2_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># grid.arrange(plot1, plot2, ncol = 2)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The number of trafficking cases generally trended downwards between 2017 and 2022, though there was a momentary increase between 2019 and 2020. Meanwhile the number of posession cases with intent to distribute rose steadily until 2021, before plunging in 2022.</p>
</section>
<section id="th2.4.2-plotting-changes-in-drug-use-cases-by-time" class="level3">
<h3 class="anchored" data-anchor-id="th2.4.2-plotting-changes-in-drug-use-cases-by-time">TH2.4.2 Plotting changes in drug use cases by time</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>thailand_drug_trafficking <span class="ot">&lt;-</span> thailand_drug <span class="sc">%&gt;%</span> <span class="fu">filter</span>(types_of_drug_offenses <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"drug_use_cases"</span>, <span class="st">"suspects_in_drug_use_cases"</span>, <span class="st">"possession_cases"</span>, <span class="st">"suspects_in_possession_cases"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fiscal_year) <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_use_cases =</span> <span class="fu">sum</span>(no_cases[types_of_drug_offenses <span class="sc">==</span> <span class="st">"drug_use_cases"</span>]),</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_suspect_use_cases =</span> <span class="fu">sum</span>(no_cases[types_of_drug_offenses <span class="sc">==</span> <span class="st">"suspects_in_drug_use_cases"</span>]),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_posession_cases =</span> <span class="fu">sum</span>(no_cases[types_of_drug_offenses <span class="sc">==</span> <span class="st">"possession_cases"</span>]),</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_suspect_posession_cases =</span> <span class="fu">sum</span>(no_cases[types_of_drug_offenses <span class="sc">==</span> <span class="st">"suspects_in_possession_cases"</span>])) <span class="sc">%&gt;%</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>thailand_drug_trafficking</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  fiscal_year total_use_cases total_suspect_use_cases total_posession_cases
        &lt;dbl&gt;           &lt;dbl&gt;                   &lt;dbl&gt;                 &lt;dbl&gt;
1        2017           91444                   93895                 90845
2        2018          146761                  150049                100941
3        2019          177078                  179823                104365
4        2020          141570                  141761                 87997
5        2021          231406                  235803                 93976
6        2022          127270                  129437                 60769
# ℹ 1 more variable: total_suspect_posession_cases &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> thailand_drug_trafficking, <span class="fu">aes</span>(<span class="at">x =</span> fiscal_year)) <span class="sc">+</span>     </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_bar(stat = "identity", fill = "red4") +</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> fiscal_year, <span class="at">y =</span> total_use_cases, <span class="at">color =</span> <span class="st">"drug_use"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> fiscal_year, <span class="at">y =</span> total_use_cases, <span class="at">color =</span> <span class="st">"drug_use"</span>), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> fiscal_year, <span class="at">y =</span> total_suspect_use_cases, <span class="at">color =</span> <span class="st">"suspects_in_drug_use_cases"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> fiscal_year, <span class="at">y =</span> total_suspect_use_cases, <span class="at">color =</span> <span class="st">"suspects_in_drug_use_cases"</span>), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> fiscal_year, <span class="at">y =</span> total_posession_cases, <span class="at">color =</span> <span class="st">"possession_cases"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> fiscal_year, <span class="at">y =</span> total_posession_cases, <span class="at">color =</span> <span class="st">"possession_cases"</span>), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> fiscal_year, <span class="at">y =</span> total_suspect_posession_cases, <span class="at">color =</span> <span class="st">"suspects_in_possession_cases"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> fiscal_year, <span class="at">y =</span> total_suspect_posession_cases, <span class="at">color =</span> <span class="st">"suspects_in_possession_cases"</span>), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Drug use and suspected cases by year"</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Number of cases"</span>) <span class="sc">+</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"drug_use"</span> <span class="ot">=</span> <span class="st">"skyblue1"</span>, <span class="st">"suspects_in_drug_use_cases"</span> <span class="ot">=</span> <span class="st">"green3"</span>, <span class="st">"possession_cases"</span> <span class="ot">=</span> <span class="st">"red2"</span>, <span class="st">"suspects_in_possession_cases"</span> <span class="ot">=</span> <span class="st">"yellow3"</span>)) <span class="sc">+</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Legend"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home-2_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>There was a spike in the number of drug use cases in 2021 in an otherwise variable set of data. Meanwhile, drug possession cases generally declined after 2019, though there was a slight increase in 2021.</p>
<p>From both analysis steps, it makes sense to select the drug use cases trafficking cases in 2021 for further analysis. The year 2021 coincided with a rise in the country’s unemployment rate to 1.2% from 0.7% two years prior (World Bank Open Data, n.d.), as the Thai economy was still recovering from the COVID-19 pandemic. Unemployment increases susceptibility to, among other negative effects, drug use.</p>
</section>
</section>
<section id="th2.4.3-creating-filtered-table-for-2021-observations" class="level2">
<h2 class="anchored" data-anchor-id="th2.4.3-creating-filtered-table-for-2021-observations">TH2.4.3 Creating filtered table for 2021 observations</h2>
<p>The following code chunks create a filtered table for the <em>confirmed</em> drug use and trafficking observations that occurred in 2021, groups and summarises them by province, and plots the numbers onto the provincial map of Thailand.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>thailand_2021_drug <span class="ot">&lt;-</span> thailand_drug <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fiscal_year <span class="sc">==</span> <span class="st">"2021"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(types_of_drug_offenses <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"drug_use_cases"</span>, <span class="st">"trafficking_cases"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(province_en) <span class="sc">%&gt;%</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_use_cases =</span> <span class="fu">sum</span>(no_cases[types_of_drug_offenses <span class="sc">==</span> <span class="st">"drug_use_cases"</span>]),</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_trafficking_cases =</span> <span class="fu">sum</span>(no_cases[types_of_drug_offenses <span class="sc">==</span> <span class="st">"trafficking_cases"</span>])) <span class="sc">%&gt;%</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>thailand_2021_drug</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 77 × 3
   province_en   total_use_cases total_trafficking_cases
   &lt;chr&gt;                   &lt;dbl&gt;                   &lt;dbl&gt;
 1 Amnat Charoen            3012                     164
 2 Ang Thong                 755                      51
 3 Bangkok                  9625                     250
 4 Bueng Kan                2705                      20
 5 Buri Ram                 5110                     399
 6 Chachoengsao             4111                     197
 7 Chai Nat                  763                      97
 8 Chaiyaphum               4620                     181
 9 Chanthaburi              2200                      31
10 Chiang Mai               8623                     640
# ℹ 67 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>thailand_2021 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(thailand, thailand_2021_drug, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ADM1_EN"</span> <span class="ot">=</span> <span class="st">"province_en"</span>))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>thailand_2021</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 77 features and 18 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 97.34336 ymin: 5.613038 xmax: 105.637 ymax: 20.46507
Geodetic CRS:  WGS 84
First 10 features:
   Shape_Leng Shape_Area                  ADM1_EN       ADM1_TH ADM1_PCODE
1    2.417227 0.13133873                  Bangkok  กรุงเทพมหานคร       TH10
2    1.695100 0.07926199             Samut Prakan    สมุทรปราการ       TH11
3    1.251111 0.05323766               Nonthaburi         นนทบุรี       TH12
4    1.884945 0.12698345             Pathum Thani        ปทุมธานี       TH13
5    3.041716 0.21393797 Phra Nakhon Si Ayutthaya พระนครศรีอยุธยา       TH14
6    1.739908 0.07920961                Ang Thong        อ่างทอง       TH15
7    5.693342 0.54578838                 Lop Buri          ลพบุรี       TH16
8    1.778326 0.06872655                Sing Buri         สิงห์บุรี       TH17
9    2.896316 0.20907828                 Chai Nat         ชัยนาท       TH18
10   4.766446 0.29208711                 Saraburi         สระบุรี       TH19
   ADM1_REF ADM1ALT1EN ADM1ALT2EN ADM1ALT1TH ADM1ALT2TH  ADM0_EN   ADM0_TH
1      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
2      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
3      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
4      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
5      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
6      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
7      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
8      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
9      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
10     &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
   ADM0_PCODE       date    validOn validTo total_use_cases
1          TH 2019-02-18 2022-01-22    &lt;NA&gt;            9625
2          TH 2019-02-18 2022-01-22    &lt;NA&gt;            2515
3          TH 2019-02-18 2022-01-22    &lt;NA&gt;            3202
4          TH 2019-02-18 2022-01-22    &lt;NA&gt;            1747
5          TH 2019-02-18 2022-01-22    &lt;NA&gt;            1766
6          TH 2019-02-18 2022-01-22    &lt;NA&gt;             755
7          TH 2019-02-18 2022-01-22    &lt;NA&gt;            1925
8          TH 2019-02-18 2022-01-22    &lt;NA&gt;             683
9          TH 2019-02-18 2022-01-22    &lt;NA&gt;             763
10         TH 2019-02-18 2022-01-22    &lt;NA&gt;            1106
   total_trafficking_cases                       geometry
1                      250 MULTIPOLYGON (((100.6139 13...
2                      159 MULTIPOLYGON (((100.7306 13...
3                       60 MULTIPOLYGON (((100.3415 14...
4                      106 MULTIPOLYGON (((100.8916 14...
5                      112 MULTIPOLYGON (((100.5131 14...
6                       51 MULTIPOLYGON (((100.3332 14...
7                      142 MULTIPOLYGON (((101.3453 15...
8                       40 MULTIPOLYGON (((100.3691 15...
9                       97 MULTIPOLYGON (((100.1199 15...
10                      69 MULTIPOLYGON (((101.3994 15...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>use_map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand_2021) <span class="sc">+</span> <span class="fu">tm_fill</span>(<span class="st">"total_use_cases"</span>, <span class="at">n =</span> <span class="dv">8</span>, <span class="at">style =</span> <span class="st">"quantile"</span>) <span class="sc">+</span> <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>use_map_equal <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand_2021) <span class="sc">+</span> <span class="fu">tm_fill</span>(<span class="st">"total_use_cases"</span>, <span class="at">n =</span> <span class="dv">6</span>, <span class="at">style =</span> <span class="st">"equal"</span>) <span class="sc">+</span> <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(use_map <span class="sc">+</span> <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Drug use across Thailand (quantile)"</span>, <span class="at">main.title.size =</span> <span class="fl">1.2</span>, <span class="at">frame =</span> <span class="cn">TRUE</span>), use_map_equal <span class="sc">+</span> <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Drug use across Thailand (equal)"</span>, <span class="at">main.title.size =</span> <span class="fl">1.2</span>, <span class="at">frame =</span> <span class="cn">TRUE</span>), <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home-2_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Considering only confirmed cases of use and trafficking (and ignoring <em>suspected</em> ones), the provinces with the highest number of drug use cases appear clustered to the northeast, around Sakon Nakhon, and north, around Chiang Mai and Chiang Rai. Both these general regions are either within, or in close proximity to, the Golden Triangle that also encompasses northern Laos and northeastern Myanmar. There are also pockets of high use around the capital Bangkok near the Gulf of Thailand, and the southern provinces including Songkhla province on the border with Kedah, Malaysia, and the resort island province of Phuket. Surprisingly, provinces such as Kanchanaburi and Sing Buri, which are also close to the Golden Triangle, see relatively muted drug use.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>trafficking_map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand_2021) <span class="sc">+</span> <span class="fu">tm_fill</span>(<span class="st">"total_trafficking_cases"</span>, <span class="at">n =</span> <span class="dv">8</span>, <span class="at">style =</span> <span class="st">"quantile"</span>) <span class="sc">+</span> <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>trafficking_map_equal <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand_2021) <span class="sc">+</span> <span class="fu">tm_fill</span>(<span class="st">"total_trafficking_cases"</span>, <span class="at">n =</span> <span class="dv">6</span>, <span class="at">style =</span> <span class="st">"equal"</span>) <span class="sc">+</span> <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(trafficking_map  <span class="sc">+</span> <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Drug trafficking across Thailand (quantile)"</span>, <span class="at">main.title.size =</span> <span class="dv">1</span>, <span class="at">frame =</span> <span class="cn">TRUE</span>), trafficking_map_equal  <span class="sc">+</span> <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Drug trafficking across Thailand (equal)"</span>, <span class="at">main.title.size =</span> <span class="dv">1</span>, <span class="at">frame =</span> <span class="cn">TRUE</span>), <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home-2_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This same general region in the north-northeast also sees the highest concentration of drug <em>trafficking</em> cases throughout the country, with the eastern province of Ubon Ratchatani seeing the largest number of all. The further south within the country, the lower the concentration of drug cases, with one notable anomaly being Surat Thani Province, which contains another resort island - Koh Samui.</p>
<p>We will now proceed to rigourously verify these observations using global and local spatial autocorrelation techniques, such as global and local Moran’s I, Geary’s C and G-statistics. In particular, we want to verify if the indicators of drug abuse are indeed spatially dependent, i.e.&nbsp;provinces that see less drug use are clustered with one another and vice-versa, and if so, whether the high-concentration areas identified in the choropleth maps above are indeed hot spots.</p>
</section>
<section id="th2.5-deriving-global-measures-of-spatial-autocorrelation" class="level2">
<h2 class="anchored" data-anchor-id="th2.5-deriving-global-measures-of-spatial-autocorrelation">TH2.5 Deriving Global Measures of Spatial Autocorrelation</h2>
<p>Tobler’s (1970) first law of geography states that everything is related to everything else, but near things are more related than distant things. Spatial autocorrelation seeks to determine the extent of Tobler’s first law on a variable or measurement - in our case, the number of drug use and drug trafficking cases. As the illustration below (Khant, 2024) (Moraga, 2023) shows, positive spatial autocorrelation is when adjacent observations have similar data values. In contrast, negative spatial autocorrelation is when adjacent observations have contrasting values, and when the data values appear randomly distributed, no spatial autocorrelation occurs.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="moraga.png" class="img-fluid figure-img"></p>
<figcaption>An illustration on the methods of spatial autocorrelation. (Moraga, 2023)</figcaption>
</figure>
</div>
<p>We will first focus on the global measures of spatial autocorrelation: Moran’s I and Geary’s C. While both seek to determine if the measured variables (in this case, our drug use and drug trafficking statistics) are clustered, dispersed or random, the former looks at the study area as a whole, and the latter quantifies how different each subdivision (province) is different from its immediate neighbours.</p>
<section id="th2.5.1-data-preparation---spatial-weights" class="level3">
<h3 class="anchored" data-anchor-id="th2.5.1-data-preparation---spatial-weights">TH2.5.1 Data Preparation - Spatial Weights</h3>
<p>Before computing any global spatial autocorrelation statistics, we first need to construct the spatial weights of the study area. The first step in doing so will be to compute the queen contiguity spatial weights. This means we will consider all neighbours for each province that share an edge and vertex, i.e.&nbsp;are horizontally, vertically and diagonally adjacent.</p>
<p>We will create 2 row-standardised spatial weights matrices <em>for confirmed cases only</em> - one for our drug use statistics and another for our drug trafficking statistics. Row-standardisation will take the inverse of the number of neighbours each province has, as derived from our vanilla queen contiguity spatial weights matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>thailand_2021_use <span class="ot">&lt;-</span> thailand_2021 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">17</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>thailand_2021_trafficking <span class="ot">&lt;-</span> thailand_2021 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">18</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>wm_q_use <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(thailand_2021_use, <span class="at">queen=</span><span class="cn">TRUE</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>wm_q_tr <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(thailand_2021_trafficking, <span class="at">queen=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Weights matrix for drug use cases"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Weights matrix for drug use cases"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wm_q_use)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 77 
Number of nonzero links: 352 
Percentage nonzero weights: 5.93692 
Average number of links: 4.571429 
1 region with no links:
67
2 disjoint connected subgraphs
Link number distribution:

 0  1  2  3  4  5  6  7  8  9 
 1  1  5 17 15 17 10  5  4  2 
1 least connected region:
14 with 1 link
2 most connected regions:
29 51 with 9 links</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Weights matrix for drug trafficking cases"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Weights matrix for drug trafficking cases"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wm_q_tr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 77 
Number of nonzero links: 352 
Percentage nonzero weights: 5.93692 
Average number of links: 4.571429 
1 region with no links:
67
2 disjoint connected subgraphs
Link number distribution:

 0  1  2  3  4  5  6  7  8  9 
 1  1  5 17 15 17 10  5  4  2 
1 least connected region:
14 with 1 link
2 most connected regions:
29 51 with 9 links</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>rswm_q_use <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(wm_q_use, <span class="at">style =</span> <span class="st">"W"</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>rswm_q_tr <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(wm_q_tr, <span class="at">style =</span> <span class="st">"W"</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 77 
Number of nonzero links: 352 
Percentage nonzero weights: 5.93692 
Average number of links: 4.571429 
1 region with no links:
67
2 disjoint connected subgraphs

Weights style: W 
Weights constants summary:
   n   nn S0       S1      S2
W 76 5776 76 36.26113 315.652</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 77 
Number of nonzero links: 352 
Percentage nonzero weights: 5.93692 
Average number of links: 4.571429 
1 region with no links:
67
2 disjoint connected subgraphs

Weights style: W 
Weights constants summary:
   n   nn S0       S1      S2
W 76 5776 76 36.26113 315.652</code></pre>
</div>
</div>
<p>We will also define our null and alternative hypotheses as such:</p>
<ul>
<li>**Null Hypotheses <span class="math inline">\(H_0_\)</span>: the tests indicate no spatial autocorrelation:
<ul>
<li>For <em>Moran’s I</em>: <span class="math inline">\(H_0_: I = E[I] = 0\)</span>, and;</li>
<li>For <em>Geary’s C</em>:</li>
</ul></li>
<li>**Alternative Hypotheses</li>
</ul>
</section>
<section id="th2.5.2-morans-i" class="level3">
<h3 class="anchored" data-anchor-id="th2.5.2-morans-i">TH2.5.2 Moran’s I</h3>
<p>With our matrices constructed, we can calculate our global spatial correlation statistics. Moran’s I describes how features differ from the values in the study area as a whole. It approaches 1 when similar values are clustered, and approaches -1 when dissimilar values tend to cluster.</p>
<p>The code chunk below computes Moran’s I on our <em>drug use</em> dataset, subsequently performing a Monte Carlo test and plotting the result in a histogram. We can use the histogram to visualise the permutation results and compare them to the expected value under null hypothesis.</p>
<section id="th2.5.2.1-morans-i-on-drug_use-statistics" class="level4">
<h4 class="anchored" data-anchor-id="th2.5.2.1-morans-i-on-drug_use-statistics">TH2.5.2.1 Moran’s I on <code>drug_use</code> statistics</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(thailand_2021<span class="sc">$</span>total_use_cases, <span class="at">listw=</span>rswm_q_use, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>, <span class="at">na.action=</span>na.omit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  thailand_2021$total_use_cases  
weights: rswm_q_use  
n reduced by no-neighbour observations  

Moran I statistic standard deviate = 2.862, p-value = 0.002105
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
       0.20376109       -0.01333333        0.00575372 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>bperm_use <span class="ot">&lt;-</span> <span class="fu">moran.mc</span>(thailand_2021<span class="sc">$</span>total_use_cases, </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">listw=</span>rswm_q_use, </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">nsim=</span><span class="dv">999</span>, </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">zero.policy =</span> <span class="cn">TRUE</span>, </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">na.action=</span>na.omit)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>bperm_use</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Moran I

data:  thailand_2021$total_use_cases 
weights: rswm_q_use  
number of simulations + 1: 1000 

statistic = 0.20376, observed rank = 993, p-value = 0.007
alternative hypothesis: greater</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(bperm_use<span class="sc">$</span>res, <span class="at">main =</span> <span class="st">"Global Moran's I Simulation Results for drug_use"</span>, <span class="at">xlab=</span><span class="st">"Monte-Carlo Results"</span>, <span class="at">ylab=</span><span class="st">"Frequency"</span>) </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> bperm_use<span class="sc">$</span>statistic, <span class="at">col =</span> <span class="st">"green4"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home-2_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From the output above:</p>
<ul>
<li>The Moran’s I statistic is approximately <code>0.20</code>, which is significantly higher than the expected value of <code>-0.014</code>. This is a significant indicator of positive spatial autocorrelation, but only to a moderate degree.</li>
<li>With a standard deviation of <code>2.86</code> and p-value of <code>0.0021 &lt; 0.05</code> at a 95% confidence level, the test result is statistically significant. We can reject the null hypothesis of a lack of spatial autocorrelation.</li>
<li>After 1000 permutations, we get a similar Moran’s I observation of <code>0.2038</code>, with a p-value of <code>0.007</code>. Therefore, our result is stable and statistically significant.</li>
</ul>
<p>This shows that provinces with high drug use in Thailand can, to a limited extent, be near one another.</p>
</section>
<section id="th2.5.2.2-morans-i-on-drug_trafficking-statistics" class="level4">
<h4 class="anchored" data-anchor-id="th2.5.2.2-morans-i-on-drug_trafficking-statistics">TH2.5.2.2 Moran’s I on <code>drug_trafficking</code> statistics</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(thailand_2021<span class="sc">$</span>total_trafficking_cases, <span class="at">listw=</span>rswm_q_tr, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>, <span class="at">na.action=</span>na.omit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  thailand_2021$total_trafficking_cases  
weights: rswm_q_tr  
n reduced by no-neighbour observations  

Moran I statistic standard deviate = 3.3324, p-value = 0.0004304
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
       0.22018889       -0.01333333        0.00491054 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>bperm_tr <span class="ot">&lt;-</span> <span class="fu">moran.mc</span>(thailand_2021<span class="sc">$</span>total_trafficking_cases, </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">listw=</span>rswm_q_tr, </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">nsim=</span><span class="dv">999</span>, </span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">zero.policy =</span> <span class="cn">TRUE</span>, </span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">na.action=</span>na.omit)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>bperm_tr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Moran I

data:  thailand_2021$total_trafficking_cases 
weights: rswm_q_tr  
number of simulations + 1: 1000 

statistic = 0.22019, observed rank = 998, p-value = 0.002
alternative hypothesis: greater</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(bperm_use<span class="sc">$</span>res, <span class="at">main =</span> <span class="st">"Global Moran's I Simulation Results for drug_trafficking"</span>, <span class="at">xlab=</span><span class="st">"Monte-Carlo Results"</span>, <span class="at">ylab=</span><span class="st">"Frequency"</span>) </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> bperm_tr<span class="sc">$</span>statistic, <span class="at">col =</span> <span class="st">"purple4"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home-2_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The output for our <code>drug_trafficking</code> statistics is similar to that for our <code>drug_use</code> statistics, and can be interpreted as follows:</p>
<ul>
<li>The Moran’s I statistic is approximately <code>0.22</code>, which is significantly higher than the expected value of <code>-0.014</code>. This value is close to that obtained from our <code>drug_use</code> statistics, which indicates that both categories of drug crimes are similarly and moderately clustered.</li>
<li>With a standard deviation of <code>3.33</code> and p-value of <code>0.0004 &lt; 0.05</code> at a 95% confidence level, the test result is statistically significant. We can reject the null hypothesis of a lack of spatial autocorrelation.</li>
<li>After 1000 permutations, we get a similar Moran’s I observation of <code>0.21947</code>, with a p-value of <code>0.002</code>. Therefore, our result is stable and statistically significant.</li>
</ul>
<p>Like drug use, using Moran’s I show that provinces with high drug trafficking in Thailand can, to a limited extent, be near one another.</p>
</section>
</section>
</section>
<section id="th2.6-gearys-c" class="level2">
<h2 class="anchored" data-anchor-id="th2.6-gearys-c">TH2.6 Geary’s C</h2>
<p>Geary’s C is another measure of global spatial autocorrelation that describes how features differ from their immediate neighbours. When <code>C &gt; 1</code>, the points are dispersed, and while <code>C &lt; 1</code>, the points are clustered. A <code>C</code> value of <code>1</code> indicates observations are randomly arranged in space. Geary’s C approaches <code>0</code> when similar values are clustered, and approaches <code>3</code> when dissimilar values are clustered. Geary’s C is inversely proportional to Moran’s I, so higher Cs correspond to lower Is.</p>
<p>Just as before, we will now perform Geary’s C on both our <code>drug_use</code> and <code>drug_trafficking</code> statistics.</p>
<section id="th2.6.1-gearys-c-on-drug_use-statistics" class="level3">
<h3 class="anchored" data-anchor-id="th2.6.1-gearys-c-on-drug_use-statistics">TH2.6.1 Geary’s C on <code>drug_use</code> statistics</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geary.test</span>(thailand_2021<span class="sc">$</span>total_use_cases, <span class="at">listw=</span>rswm_q_use, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>, <span class="at">na.action =</span> na.omit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Geary C test under randomisation

data:  thailand_2021$total_use_cases 
weights: rswm_q_use  
n reduced by no-neighbour observations 

Geary C statistic standard deviate = 1.8151, p-value = 0.03476
alternative hypothesis: Expectation greater than statistic
sample estimates:
Geary C statistic       Expectation          Variance 
      0.843832653       1.000000000       0.007402704 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>bperm_use <span class="ot">&lt;-</span> <span class="fu">geary.mc</span>(thailand_2021<span class="sc">$</span>total_use_cases, </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">listw=</span>rswm_q_use, </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">nsim=</span><span class="dv">999</span>,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">zero.policy =</span> <span class="cn">TRUE</span>,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">na.action =</span> na.omit)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>bperm_use</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Geary C

data:  thailand_2021$total_use_cases 
weights: rswm_q_use  
number of simulations + 1: 1000 

statistic = 0.84383, observed rank = 61, p-value = 0.061
alternative hypothesis: greater</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(bperm_use<span class="sc">$</span>res, <span class="at">main =</span> <span class="st">"Geary's C Simulation Results for drug_use"</span>, <span class="at">xlab=</span><span class="st">"Monte-Carlo Results"</span>, <span class="at">ylab=</span><span class="st">"Frequency"</span>) </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> bperm_use<span class="sc">$</span>statistic, <span class="at">col =</span> <span class="st">"green4"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home-2_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From the output above:</p>
<ul>
<li>The Geary’s C statistic is approximately <code>0.84</code>, which is lower than the expected value of <code>1.0</code>. Just as a high Moran’s I indicates positive spatial correlation, our Geary’s C statistic, which is less than <code>1</code>, indicates likewise. Similarly to the conclusion of our Moran’s I investigation, the Geary’s C statistic only indicates moderate positive spatial correlation.</li>
<li>With a standard deviation of <code>3.24 and p-value of</code>0.035 &lt; 0.05`, the test result is statistically significant. If we were to only run the test once, we should be able to reject the null hypothesis of a lack of spatial autocorrelation.</li>
<li>However, while running 1000 permutations yielded a similar Geary’s C observation of <code>0.84383</code>, this time, our p-value of <code>0.061</code> is <em>greater</em> than our threshold of <code>0.05</code> at the 95% confidence level. Had we only used Geary’s C, we would not have strong statistical evidence to reject our null hypothesis.</li>
</ul>
<p>Hence, the Geary’s C statistic on drug use cases in 2021 yielded inconclusive results.</p>
</section>
<section id="th2.6.2-gearys-c-on-drug_trafficking-statistics" class="level3">
<h3 class="anchored" data-anchor-id="th2.6.2-gearys-c-on-drug_trafficking-statistics">TH2.6.2 Geary’s C on <code>drug_trafficking</code> statistics</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geary.test</span>(thailand_2021<span class="sc">$</span>total_trafficking_cases, <span class="at">listw=</span>rswm_q_tr, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>, <span class="at">na.action =</span> na.omit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Geary C test under randomisation

data:  thailand_2021$total_trafficking_cases 
weights: rswm_q_tr  
n reduced by no-neighbour observations 

Geary C statistic standard deviate = 2.3998, p-value = 0.008202
alternative hypothesis: Expectation greater than statistic
sample estimates:
Geary C statistic       Expectation          Variance 
       0.73939266        1.00000000        0.01179295 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>bperm_tr <span class="ot">&lt;-</span> <span class="fu">geary.mc</span>(thailand_2021<span class="sc">$</span>total_trafficking_cases, </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">listw=</span>rswm_q_tr, </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">nsim=</span><span class="dv">999</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>, <span class="at">na.action =</span> na.omit)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>bperm_tr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Geary C

data:  thailand_2021$total_trafficking_cases 
weights: rswm_q_tr  
number of simulations + 1: 1000 

statistic = 0.73939, observed rank = 20, p-value = 0.02
alternative hypothesis: greater</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(bperm_use<span class="sc">$</span>res, <span class="at">main =</span> <span class="st">"Global Geary's C Simulation Results for drug_trafficking"</span>, <span class="at">xlab=</span><span class="st">"Monte-Carlo Results"</span>, <span class="at">ylab=</span><span class="st">"Frequency"</span>) </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> bperm_tr<span class="sc">$</span>statistic, <span class="at">col =</span> <span class="st">"purple4"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home-2_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>When Geary’s C is run on the <code>drug_trafficking</code> statistics:</p>
<ul>
<li>The result yielded is approximately <code>0.74</code>, which is lower than the expected value of <code>1.0</code>. It is also lower than the Geary’s C for the drug use data, which indicates that the clustering of drug trafficking hotspots is stronger than that for drug use.</li>
<li>With a standard deviation of <code>2.40</code> and p-value of <code>0.008 &lt; 0.05</code> for a 95% confidence level, the test result is statistically significant. If we were to only run the test once, we should be able to reject the null hypothesis of a lack of spatial autocorrelation.</li>
<li>Now, running 1000 permutations yielded a similar Geary’s C observation of <code>0.73939</code> and a p-value of <code>0.02 &lt; 0.05</code> at the 95% confidence level. Even though the p-value is uncomfortably close to the threshold, we can still conclude that our derived Geary’s C for our drug trafficking data is statistically significant.</li>
</ul>
<p>Hence, the Geary’s C measure on drug trafficking cases in 2021 indicates mild positive spatial autocorrelation, albeit stronger than that observed on our drug use statistics.</p>
</section>
</section>
<section id="th2.7-deriving-local-measures-of-spatial-autocorrelation" class="level2">
<h2 class="anchored" data-anchor-id="th2.7-deriving-local-measures-of-spatial-autocorrelation">TH2.7 Deriving Local Measures of Spatial Autocorrelation</h2>
<p>Both Global Moran’s I and Geary’s C only return a surface observation on how Thailand’s drug crime is distributed by province. To identify where the clusters are located, we need to use local indicators of spatial association (LISA), which indicate the extent of spatial clustering around each observation (Anselin, 1995) (Khant, 2024).</p>
<p>An example of a LISA is local Moran’s I, which is essentially Moran’s I calculated for each geographical subdivision, in this case the provinces of Thailand. However, with these localised measures, we are able to visualise our findings on a choropleth map, and from there, identify the locations of noteworthy clusters.</p>
<p>As before, we will derive the local Moran’s I statistics for both our drug trafficking and drug use data. The <code>localmoran()</code> function use here returns a matrix whose columns mean the following (Kam, 2022):</p>
<ul>
<li><code>Ii</code>: the local Moran’s I statistics</li>
<li><code>E.Ii</code>: the expectation of the local Moran’s I statistics under the randomisation hypothesis</li>
<li><code>Var.Ii</code>: the variance of the local Moran’s I statistics under the randomisation hypothesis</li>
<li><code>Z.Ii</code>:the standard deviation, and</li>
<li><code>Pr()</code>: the p-value.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>local_MI_use <span class="ot">&lt;-</span> <span class="fu">localmoran</span>(thailand_2021<span class="sc">$</span>total_use_cases, rswm_q_use)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>local_MI_trafficking <span class="ot">&lt;-</span> <span class="fu">localmoran</span>(thailand_2021<span class="sc">$</span>total_trafficking_cases, rswm_q_tr)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind local Moran's I to the Thailand dataset</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>thailand_2021_use.localMI <span class="ot">&lt;-</span> <span class="fu">cbind</span>(thailand_2021, local_MI_use) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Pr.Ii =</span> Pr.z....E.Ii..)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>thailand_2021_trafficking.localMI <span class="ot">&lt;-</span> <span class="fu">cbind</span>(thailand_2021, local_MI_trafficking) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Pr.Ii =</span> Pr.z....E.Ii..)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can then proceed to map the local Moran’s I statistics and p-values. The colour palette used for mapping local Moran’s I p-values (Khant, 2024) helps us easily identify statistically significant results, once again for a 95% confidence interval.</p>
<section id="th2.7.1-mapping-local-morans-i-statistics-for-drug_use-cases" class="level3">
<h3 class="anchored" data-anchor-id="th2.7.1-mapping-local-morans-i-statistics-for-drug_use-cases">TH2.7.1 Mapping Local Moran’s I statistics for <code>drug_use</code> cases</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>use.localMI.map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand_2021_use.localMI) <span class="sc">+</span> <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"Ii"</span>, <span class="at">style =</span> <span class="st">"pretty"</span>, <span class="at">title =</span> <span class="st">"drug_use local Moran"</span>) <span class="sc">+</span> <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>use.pv.map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand_2021_use.localMI) <span class="sc">+</span> <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"Pr.Ii"</span>, </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks=</span><span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="cn">Inf</span>),</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette=</span><span class="fu">c</span>(<span class="st">"#b7dce9"</span>,<span class="st">"#c9e3d2"</span>,<span class="st">"#f5f3a6"</span>,<span class="st">"#ec9a64"</span>,<span class="st">"#d21b1c"</span>), </span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"drug_use p-values"</span>) <span class="sc">+</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(use.localMI.map, use.pv.map, <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Variable(s) "Ii" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home-2_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>There are statistcally significant instances of dissimilar clustering toward the south in Krabi and Phattalung provinces, and a handful towards the central and north. With p-values of <code>0.1</code> or more, the local Moran’s I values for the rest of the country cannot be considered to be statistically significant. This is a surprising result for our <code>drug_use</code> data.</p>
</section>
<section id="th2.7.2-mapping-local-morans-i-statistics-for-drug_trafficking-cases" class="level3">
<h3 class="anchored" data-anchor-id="th2.7.2-mapping-local-morans-i-statistics-for-drug_trafficking-cases">TH2.7.2 Mapping Local Moran’s I statistics for <code>drug_trafficking</code> cases</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>tr.localMI.map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand_2021_trafficking.localMI) <span class="sc">+</span> <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"Ii"</span>, <span class="at">style =</span> <span class="st">"pretty"</span>, <span class="at">title =</span> <span class="st">"drug_trafficking local Moran"</span>) <span class="sc">+</span> <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>tr.pv.map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand_2021_trafficking.localMI) <span class="sc">+</span> <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"Pr.Ii"</span>, </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks=</span><span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="cn">Inf</span>),</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette=</span><span class="fu">c</span>(<span class="st">"#b7dce9"</span>,<span class="st">"#c9e3d2"</span>,<span class="st">"#f5f3a6"</span>,<span class="st">"#ec9a64"</span>,<span class="st">"#d21b1c"</span>), </span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"drug_trafficking p-values"</span>) <span class="sc">+</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(tr.localMI.map, tr.pv.map, <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Variable(s) "Ii" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home-2_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>And likewise for our <code>drug_trafficking</code> statistics. The only statistically significant observation that confirms the hypothesis is Chiang Rai province up north, and Si Sa Ket, the western neighbour of Ubon Ratchathani province, to the east.</p>
</section>
<section id="th2.7.3-performing-local-morans-i-monte-carlo-test-for-drug_use-cases" class="level3">
<h3 class="anchored" data-anchor-id="th2.7.3-performing-local-morans-i-monte-carlo-test-for-drug_use-cases">TH2.7.3 Performing Local Moran’s I Monte Carlo test for <code>drug_use</code> cases</h3>
<p>Just like with global Moran’s I, we can also perform a Monte Carlo permutation test for local Moran’s I, and hopefully return a more realistic result.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>local_MI_use <span class="ot">&lt;-</span> <span class="fu">localmoran_perm</span>(thailand_2021<span class="sc">$</span>total_use_cases, rswm_q_use, <span class="at">nsim =</span> <span class="dv">999</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>local_MI_trafficking <span class="ot">&lt;-</span> <span class="fu">localmoran_perm</span>(thailand_2021<span class="sc">$</span>total_trafficking_cases, rswm_q_tr, <span class="at">nsim =</span> <span class="dv">999</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind local Moran's I permutation to the Thailand dataset</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>thailand_2021_use.localMI <span class="ot">&lt;-</span> <span class="fu">cbind</span>(thailand_2021, local_MI_use) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Pr.Ii =</span> Pr.z....E.Ii..)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>thailand_2021_trafficking.localMI <span class="ot">&lt;-</span> <span class="fu">cbind</span>(thailand_2021, local_MI_trafficking) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Pr.Ii =</span> Pr.z....E.Ii..)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>use.localMI.map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand_2021_use.localMI) <span class="sc">+</span> <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"Ii"</span>, <span class="at">style =</span> <span class="st">"pretty"</span>, <span class="at">title =</span> <span class="st">"drug_use local Moran"</span>) <span class="sc">+</span> <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>use.pv.map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand_2021_use.localMI) <span class="sc">+</span> <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"Pr.Ii"</span>, </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks=</span><span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="cn">Inf</span>),</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette=</span><span class="fu">c</span>(<span class="st">"#b7dce9"</span>,<span class="st">"#c9e3d2"</span>,<span class="st">"#f5f3a6"</span>,<span class="st">"#ec9a64"</span>,<span class="st">"#d21b1c"</span>), </span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"drug_use p-values"</span>) <span class="sc">+</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(use.localMI.map, use.pv.map, <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Variable(s) "Ii" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home-2_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="th2.7.4-performing-local-morans-i-monte-carlo-test-for-drug_trafficking-cases" class="level3">
<h3 class="anchored" data-anchor-id="th2.7.4-performing-local-morans-i-monte-carlo-test-for-drug_trafficking-cases">TH2.7.4 Performing Local Moran’s I Monte Carlo test for <code>drug_trafficking</code> cases</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>tr.localMI.map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand_2021_trafficking.localMI) <span class="sc">+</span> <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"Ii"</span>, <span class="at">style =</span> <span class="st">"pretty"</span>, <span class="at">title =</span> <span class="st">"drug_trafficking local Moran"</span>) <span class="sc">+</span> <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>tr.pv.map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand_2021_trafficking.localMI) <span class="sc">+</span> <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"Pr.Ii"</span>, </span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks=</span><span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="cn">Inf</span>),</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette=</span><span class="fu">c</span>(<span class="st">"#b7dce9"</span>,<span class="st">"#c9e3d2"</span>,<span class="st">"#f5f3a6"</span>,<span class="st">"#ec9a64"</span>,<span class="st">"#d21b1c"</span>), </span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"drug_trafficking p-values"</span>) <span class="sc">+</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(tr.localMI.map, tr.pv.map, <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Variable(s) "Ii" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home-2_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Just like last time, the only statistically significant areas to confirm the hypothesis are Chiang Rai and Si Sa Ket.</p>
<p>Even after 999 simulations, we get results with p-values exceeding <code>0.05</code> for a 95% confidence interval, rendering the local Moran’s I values generated to be inconclusive.</p>
</section>
</section>
<section id="th2.7.5-drawing-local-morans-i-scatterplots" class="level2">
<h2 class="anchored" data-anchor-id="th2.7.5-drawing-local-morans-i-scatterplots">TH2.7.5 Drawing local Moran’s I scatterplots</h2>
<p>The local Moran’s I scatterplot illustrates the relationship between the drug use and trafficking statistics at each location, and the average values at neighbouring locations. It returns a plot with four quardrants which should be interested as shown in the image below (Kam, 2022).</p>
<p><a href="https://is415-ay2024-25t1.netlify.app/lesson/lesson06/img/image7-15.jpg">Interpretation of Local Moran’s I scatterplot</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>nci_use <span class="ot">&lt;-</span> <span class="fu">moran.plot</span>(thailand_2021_use<span class="sc">$</span>total_use_cases, rswm_q_use, <span class="at">labels =</span> thailand_2021_use<span class="sc">$</span>ADM1_EN, <span class="at">xlab =</span> <span class="st">"total_use_cases"</span>, <span class="at">ylab =</span> <span class="st">"Spatially lagged total_use_cases"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home-2_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>nci_tr <span class="ot">&lt;-</span> <span class="fu">moran.plot</span>(thailand_2021_trafficking<span class="sc">$</span>total_trafficking_cases, rswm_q_tr, <span class="at">labels =</span> thailand_2021_trafficking<span class="sc">$</span>ADM1_EN, <span class="at">xlab =</span> <span class="st">"total_trafficking_cases"</span>, <span class="at">ylab =</span> <span class="st">"Spatially lagged total_trafficking_cases"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home-2_files/figure-html/unnamed-chunk-25-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In terms of drug usage, notable high outliers among low neighbours are Chiang Mai, Bangkok and Phuket, whereas a notable low outlier among high neighbours is Samut Prakan, which is Bangkok’s southeastern neighbour.</p>
<p>In terms of drug trafficking, a notable low outlier among high neighbours is Mae Hong Song, on the eastern border with Myanmar and within the Golden Triangle. Major provinces within the Triangle - namely Chiang Rai and Chiang Mai - are considered to be clustered with neighbours also seeing high trafficking.</p>
<section id="th2.7.6-creating-lisa-cluster-map" class="level3">
<h3 class="anchored" data-anchor-id="th2.7.6-creating-lisa-cluster-map">TH2.7.6 Creating LISA cluster map</h3>
<p>The above information can also be plotted onto a map colourcoded by the type of spatial autocorrelation. The code chunks below create our LISA maps from our local Moran’s I statistics, and plots the resulting quadrant map along with their corresponding quantile-classified basemaps.</p>
<section id="th2.7.6.1-lisa-cluster-map-for-drug-use-data" class="level4">
<h4 class="anchored" data-anchor-id="th2.7.6.1-lisa-cluster-map-for-drug-use-data">TH2.7.6.1 LISA cluster map for drug use data</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>quadrant <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"numeric"</span>, <span class="at">length =</span> <span class="fu">nrow</span>(local_MI_use))</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>thailand_2021_use<span class="sc">$</span>lag_total_use <span class="ot">&lt;-</span> <span class="fu">lag.listw</span>(rswm_q_use, thailand_2021_use<span class="sc">$</span>total_use_cases)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>DV <span class="ot">&lt;-</span> thailand_2021_use<span class="sc">$</span>lag_total_use <span class="sc">-</span> <span class="fu">mean</span>(thailand_2021_use<span class="sc">$</span>lag_total_use)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>LM_I <span class="ot">&lt;-</span> local_MI_use[,<span class="dv">1</span>] <span class="sc">-</span> <span class="fu">mean</span>(local_MI_use[,<span class="dv">1</span>])</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>signif <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&lt;</span><span class="dv">0</span> <span class="sc">&amp;</span> LM_I<span class="sc">&gt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> LM_I<span class="sc">&lt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&lt;</span><span class="dv">0</span> <span class="sc">&amp;</span> LM_I<span class="sc">&lt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">3</span>  </span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> LM_I<span class="sc">&gt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">4</span>    </span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>quadrant[local_MI_use[,<span class="dv">5</span>]<span class="sc">&gt;</span>signif] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>thailand_2021_use.localMI<span class="sc">$</span>quadrant <span class="ot">&lt;-</span> quadrant</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#ffffff"</span>, <span class="st">"#2c7bb6"</span>, <span class="st">"#abd9e9"</span>, <span class="st">"#fdae61"</span>, <span class="st">"#d7191c"</span>)</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"insignificant"</span>, <span class="st">"low-low"</span>, <span class="st">"low-high"</span>, <span class="st">"high-low"</span>, <span class="st">"high-high"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>use_LISA <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand_2021_use.localMI) <span class="sc">+</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"quadrant"</span>, </span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"cat"</span>, </span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> colors[<span class="fu">c</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(quadrant)))<span class="sc">+</span><span class="dv">1</span>], </span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">labels =</span> clusters[<span class="fu">c</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(quadrant)))<span class="sc">+</span><span class="dv">1</span>],</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">popup.vars =</span> <span class="fu">c</span>(<span class="st">""</span>)) <span class="sc">+</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_view</span>(<span class="at">set.zoom.limits =</span> <span class="fu">c</span>(<span class="dv">11</span>,<span class="dv">17</span>)) <span class="sc">+</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha=</span><span class="fl">0.5</span>)</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(use_LISA, use_map)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home-2_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="th2.7.6.2-lisa-cluster-map-for-drug-trafficking-data" class="level4">
<h4 class="anchored" data-anchor-id="th2.7.6.2-lisa-cluster-map-for-drug-trafficking-data">TH2.7.6.2 LISA cluster map for drug trafficking data</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>quadrant <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"numeric"</span>, <span class="at">length =</span> <span class="fu">nrow</span>(local_MI_trafficking))</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>thailand_2021_trafficking<span class="sc">$</span>lag_total_trafficking <span class="ot">&lt;-</span> <span class="fu">lag.listw</span>(rswm_q_use, thailand_2021_trafficking<span class="sc">$</span>total_trafficking_cases)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>DV <span class="ot">&lt;-</span> thailand_2021_trafficking<span class="sc">$</span>lag_total_trafficking <span class="sc">-</span> <span class="fu">mean</span>(thailand_2021_trafficking<span class="sc">$</span>lag_total_trafficking)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>LM_I <span class="ot">&lt;-</span> local_MI_trafficking[,<span class="dv">1</span>] <span class="sc">-</span> <span class="fu">mean</span>(local_MI_trafficking[,<span class="dv">1</span>])</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>signif <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&lt;</span><span class="dv">0</span> <span class="sc">&amp;</span> LM_I<span class="sc">&gt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> LM_I<span class="sc">&lt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&lt;</span><span class="dv">0</span> <span class="sc">&amp;</span> LM_I<span class="sc">&lt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">3</span>  </span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> LM_I<span class="sc">&gt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">4</span>    </span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>quadrant[local_MI_trafficking[,<span class="dv">5</span>]<span class="sc">&gt;</span>signif] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>thailand_2021_trafficking.localMI<span class="sc">$</span>quadrant <span class="ot">&lt;-</span> quadrant</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#ffffff"</span>, <span class="st">"#2c7bb6"</span>, <span class="st">"#abd9e9"</span>, <span class="st">"#fdae61"</span>, <span class="st">"#d7191c"</span>)</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"insignificant"</span>, <span class="st">"low-low"</span>, <span class="st">"low-high"</span>, <span class="st">"high-low"</span>, <span class="st">"high-high"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>tr_LISA <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand_2021_trafficking.localMI) <span class="sc">+</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"quadrant"</span>, </span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"cat"</span>, </span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> colors[<span class="fu">c</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(quadrant)))<span class="sc">+</span><span class="dv">1</span>], </span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">labels =</span> clusters[<span class="fu">c</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(quadrant)))<span class="sc">+</span><span class="dv">1</span>],</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">popup.vars =</span> <span class="fu">c</span>(<span class="st">""</span>)) <span class="sc">+</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_view</span>(<span class="at">set.zoom.limits =</span> <span class="fu">c</span>(<span class="dv">11</span>,<span class="dv">17</span>)) <span class="sc">+</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha=</span><span class="fl">0.5</span>)</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(tr_LISA, trafficking_map)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home-2_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="th2.8-using-local-gi-statistics-to-perform-hot-and-cold-spot-analysis" class="level2">
<h2 class="anchored" data-anchor-id="th2.8-using-local-gi-statistics-to-perform-hot-and-cold-spot-analysis">TH2.8 Using Local Gi* statistics to perform hot and cold spot analysis</h2>
<p>We need more local indicators to determine the extent of clustering in our drug crime data. Another method we can use is creating <strong>Gertis and Ord’s G-statistics</strong>. One of the earliest LISAs (Khant, 2024), they seek to determine the locations of clusters of high and low values - in our case, clusters of provinces with high incidences of drug trafficking, and clusters of those with low incidences of such. These scores are typically reported as z-scores, where positive values indicate a high-high cluster, and negative values indicate a low-low cluster.</p>
<p>The analysis consists of three steps:</p>
<ol type="1">
<li>Deriving the spatial weight matrix,</li>
<li>Computing the Gi statistics</li>
<li>Mapping the Gi statistics</li>
</ol>
<section id="th2.8.1-drug_use-dataset" class="level3">
<h3 class="anchored" data-anchor-id="th2.8.1-drug_use-dataset">TH2.8.1 <code>drug_use</code> dataset</h3>
<section id="th2.8.1.1-deriving-distance-based-weight-matrices" class="level4">
<h4 class="anchored" data-anchor-id="th2.8.1.1-deriving-distance-based-weight-matrices">TH2.8.1.1 Deriving distance-based weight matrices</h4>
<p>First, we define an adaptive distance-based weight matrix. We will do this by creating centroids - points associated with each polygon - by extracting longitudes and latitudes. This is done by mapping the <code>st_centroid()</code> function to each polygon in our dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drug_use data</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>longitude <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(thailand_2021_use<span class="sc">$</span>geometry, <span class="sc">~</span><span class="fu">st_centroid</span>(.x)[[<span class="dv">1</span>]])</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>latitude <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(thailand_2021_use<span class="sc">$</span>geometry, <span class="sc">~</span><span class="fu">st_centroid</span>(.x)[[<span class="dv">2</span>]])</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">cbind</span>(longitude, latitude)</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine cutoff distance</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>k1 <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(coords))</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>k1dists <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">nbdists</span>(k1, coords, <span class="at">longlat =</span> <span class="cn">TRUE</span>))</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(k1dists)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  21.55   51.92   64.33   63.24   76.77  110.94 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute fixed-distance weight matrix</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>wm_d62 <span class="ot">&lt;-</span> <span class="fu">dnearneigh</span>(coords, <span class="dv">0</span>, <span class="dv">62</span>, <span class="at">longlat =</span> <span class="cn">TRUE</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>wm_d62</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 77 
Number of nonzero links: 80 
Percentage nonzero weights: 1.3493 
Average number of links: 1.038961 
42 regions with no links:
13 14 18 19 20 21 22 23 25 27 28 29 31 33 35 36 37 38 39 40 42 44 45 46
47 48 49 50 51 52 53 54 55 57 63 64 65 66 67 68 71 72
49 disjoint connected subgraphs</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>wm62_lw <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(wm_d62, <span class="at">style =</span> <span class="st">'B'</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wm62_lw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 77 
Number of nonzero links: 80 
Percentage nonzero weights: 1.3493 
Average number of links: 1.038961 
42 regions with no links:
13 14 18 19 20 21 22 23 25 27 28 29 31 33 35 36 37 38 39 40 42 44 45 46
47 48 49 50 51 52 53 54 55 57 63 64 65 66 67 68 71 72
49 disjoint connected subgraphs
Link number distribution:

 0  1  2  3  4  5  6 
42 16  6  5  4  3  1 
16 least connected regions:
7 12 26 30 32 34 41 43 56 62 69 70 73 74 75 77 with 1 link
1 most connected region:
3 with 6 links

Weights style: B 
Weights constants summary:
   n   nn S0  S1   S2
B 35 1225 80 160 1040</code></pre>
</div>
</div>
</section>
<section id="th2.8.1.2-computing-adaptive-distance-weight-matrix" class="level4">
<h4 class="anchored" data-anchor-id="th2.8.1.2-computing-adaptive-distance-weight-matrix">TH2.8.1.2 Computing adaptive distance weight matrix</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>knn <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(coords, <span class="at">k=</span><span class="dv">8</span>))</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>knn_lw <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(knn, <span class="at">style =</span> <span class="st">'B'</span>)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(knn_lw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 77 
Number of nonzero links: 616 
Percentage nonzero weights: 10.38961 
Average number of links: 8 
Non-symmetric neighbours list
Link number distribution:

 8 
77 
77 least connected regions:
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 with 8 links
77 most connected regions:
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 with 8 links

Weights style: B 
Weights constants summary:
   n   nn  S0   S1    S2
B 77 5929 616 1088 20466</code></pre>
</div>
</div>
</section>
<section id="th2.8.1.3-computing-gi-statistics" class="level4">
<h4 class="anchored" data-anchor-id="th2.8.1.3-computing-gi-statistics">TH2.8.1.3 Computing Gi statistics</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>gi <span class="ot">&lt;-</span> <span class="fu">localG</span>(thailand_2021_use<span class="sc">$</span>total_use_cases, knn_lw)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>thailand_2021_use.gi <span class="ot">&lt;-</span> <span class="fu">cbind</span>(thailand_2021_use, <span class="fu">as.matrix</span>(gi)) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">gstat_adaptive =</span> as.matrix.gi.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="th2.8.1.4-plotting-drug_use-gi-statistics-on-map" class="level4">
<h4 class="anchored" data-anchor-id="th2.8.1.4-plotting-drug_use-gi-statistics-on-map">TH2.8.1.4 Plotting <code>drug_use</code> Gi statistics on map</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>gi_map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand_2021_use.gi) <span class="sc">+</span> <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"gstat_adaptive"</span>, <span class="at">breaks=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="fl">1.96</span>, <span class="sc">-</span><span class="fl">1.65</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">1.65</span>, <span class="fl">1.96</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="at">palette =</span> <span class="st">"-RdBu"</span>, <span class="at">title =</span> <span class="st">"drug_use local Gi"</span>) <span class="sc">+</span> <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(use_map, gi_map)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Variable(s) "gstat_adaptive" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.
Variable(s) "gstat_adaptive" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home-2_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>There is one large cold spot to the northwest of the map towards the border with Myanmar, but as far as <em>hot spots</em> are concerned, the best candidate for that is located in the east, towards the border with Cambodia and Laos, and appears lukewarm. Most of that area is only suggestive of a hotspot at a 90% confidence interval, with only 3 provinces - Maha-Sarakham, Amnat-Charoen and Surin - showing strong evidence of a hotspot at a 95% confidence interval.</p>
</section>
</section>
<section id="th2.8.2-drug_trafficking-dataset" class="level3">
<h3 class="anchored" data-anchor-id="th2.8.2-drug_trafficking-dataset">TH2.8.2 <code>drug_trafficking</code> dataset</h3>
<p>We can repeat the entire process again with our <code>drug_trafficking</code> dataset.</p>
<section id="th2.8.2.1-deriving-distance-based-weight-matrices" class="level4">
<h4 class="anchored" data-anchor-id="th2.8.2.1-deriving-distance-based-weight-matrices">TH2.8.2.1 Deriving distance-based weight matrices</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drug_trafficking data</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>longitude <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(thailand_2021_trafficking<span class="sc">$</span>geometry, <span class="sc">~</span><span class="fu">st_centroid</span>(.x)[[<span class="dv">1</span>]])</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>latitude <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(thailand_2021_trafficking<span class="sc">$</span>geometry, <span class="sc">~</span><span class="fu">st_centroid</span>(.x)[[<span class="dv">2</span>]])</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">cbind</span>(longitude, latitude)</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine cutoff distance</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>k1 <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(coords))</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>k1dists <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">nbdists</span>(k1, coords, <span class="at">longlat =</span> <span class="cn">TRUE</span>))</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(k1dists)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  21.55   51.92   64.33   63.24   76.77  110.94 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute fixed-distance weight matrix</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>wm_d62 <span class="ot">&lt;-</span> <span class="fu">dnearneigh</span>(coords, <span class="dv">0</span>, <span class="dv">62</span>, <span class="at">longlat =</span> <span class="cn">TRUE</span>)</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>wm_d62</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 77 
Number of nonzero links: 80 
Percentage nonzero weights: 1.3493 
Average number of links: 1.038961 
42 regions with no links:
13 14 18 19 20 21 22 23 25 27 28 29 31 33 35 36 37 38 39 40 42 44 45 46
47 48 49 50 51 52 53 54 55 57 63 64 65 66 67 68 71 72
49 disjoint connected subgraphs</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>wm62_lw <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(wm_d62, <span class="at">style =</span> <span class="st">'B'</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wm62_lw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 77 
Number of nonzero links: 80 
Percentage nonzero weights: 1.3493 
Average number of links: 1.038961 
42 regions with no links:
13 14 18 19 20 21 22 23 25 27 28 29 31 33 35 36 37 38 39 40 42 44 45 46
47 48 49 50 51 52 53 54 55 57 63 64 65 66 67 68 71 72
49 disjoint connected subgraphs
Link number distribution:

 0  1  2  3  4  5  6 
42 16  6  5  4  3  1 
16 least connected regions:
7 12 26 30 32 34 41 43 56 62 69 70 73 74 75 77 with 1 link
1 most connected region:
3 with 6 links

Weights style: B 
Weights constants summary:
   n   nn S0  S1   S2
B 35 1225 80 160 1040</code></pre>
</div>
</div>
</section>
<section id="th2.8.2.2-computing-adaptive-distance-weight-matrix" class="level4">
<h4 class="anchored" data-anchor-id="th2.8.2.2-computing-adaptive-distance-weight-matrix">TH2.8.2.2 Computing adaptive distance weight matrix</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>knn <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(coords, <span class="at">k=</span><span class="dv">8</span>))</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>knn_lw <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(knn, <span class="at">style =</span> <span class="st">'B'</span>)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(knn_lw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 77 
Number of nonzero links: 616 
Percentage nonzero weights: 10.38961 
Average number of links: 8 
Non-symmetric neighbours list
Link number distribution:

 8 
77 
77 least connected regions:
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 with 8 links
77 most connected regions:
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 with 8 links

Weights style: B 
Weights constants summary:
   n   nn  S0   S1    S2
B 77 5929 616 1088 20466</code></pre>
</div>
</div>
</section>
<section id="th2.8.2.3-computing-gi-statistics" class="level4">
<h4 class="anchored" data-anchor-id="th2.8.2.3-computing-gi-statistics">TH2.8.2.3 Computing Gi statistics</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>gi <span class="ot">&lt;-</span> <span class="fu">localG</span>(thailand_2021_trafficking<span class="sc">$</span>total_trafficking_cases, knn_lw)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>thailand_2021_trafficking.gi <span class="ot">&lt;-</span> <span class="fu">cbind</span>(thailand_2021_trafficking, <span class="fu">as.matrix</span>(gi)) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">gstat_adaptive =</span> as.matrix.gi.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="th2.8.2.4-plotting-drug_use-gi-statistics-on-map" class="level4">
<h4 class="anchored" data-anchor-id="th2.8.2.4-plotting-drug_use-gi-statistics-on-map">TH2.8.2.4 Plotting <code>drug_use</code> Gi statistics on map</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>gi_map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand_2021_trafficking.gi) <span class="sc">+</span> <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"gstat_adaptive"</span>, <span class="at">breaks=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="fl">1.96</span>, <span class="sc">-</span><span class="fl">1.65</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">1.65</span>, <span class="fl">1.96</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="at">palette =</span> <span class="st">"-RdBu"</span>, <span class="at">title =</span> <span class="st">"drug_trafficking local Gi"</span>) <span class="sc">+</span> <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(use_map, gi_map)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Values have found that are higher than the highest break</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Variable(s) "gstat_adaptive" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Values have found that are higher than the highest break</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Variable(s) "gstat_adaptive" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home-2_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>There are no visible cold spots for our drug trafficking data, but there is one suggestive hot spot around Chiang Mai and Chiang Rai to the north (with only Chiang Rai showing a strong possibility), and three statistically significant clusters to the east.</p>
</section>
</section>
</section>
<section id="th2.9-emerging-hotspot-analysis" class="level2">
<h2 class="anchored" data-anchor-id="th2.9-emerging-hotspot-analysis">TH2.9 Emerging Hotspot Analysis</h2>
<p>Since we have spatial-temporal data, we are able to perform emerging hotspot analysis, which will help us evaluate how the hot and cold spots in both our datasets have changed over time. It combines the Getis-Ord Gi* statistic with the Man-Kendall test, which is used to assess the direction and statistical significance of a set of data values.</p>
<section id="th2.9.1-data-wrangling-for-ehsa" class="level3">
<h3 class="anchored" data-anchor-id="th2.9.1-data-wrangling-for-ehsa">TH2.9.1 Data wrangling for EHSA</h3>
<p>We need to perform the following checks to ensure our data meets the prerequisites:</p>
<ul>
<li>The data is not collected seasonally (it was collected yearly)</li>
<li>One point per time period (each time period contains the number of drug use cases and trafficking cases only)</li>
<li>Data does not have covariates (as Ho (2024) rightly points out, while factors such as human population and unemployment rate can affect the number of drug offence cases, we have to work within our limitations in many data science tasks including this one).</li>
</ul>
<p>Our data fulfills all three requirements, so we can proceed to create a new summary table containing the total number of drug use and trafficking cases each year for each province.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>thailand_esa_drug <span class="ot">&lt;-</span> thailand_drug <span class="sc">%&gt;%</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(types_of_drug_offenses <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"drug_use_cases"</span>, <span class="st">"trafficking_cases"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(province_en, fiscal_year) <span class="sc">%&gt;%</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_use_cases =</span> <span class="fu">sum</span>(no_cases[types_of_drug_offenses <span class="sc">==</span> <span class="st">"drug_use_cases"</span>]),</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_trafficking_cases =</span> <span class="fu">sum</span>(no_cases[types_of_drug_offenses <span class="sc">==</span> <span class="st">"trafficking_cases"</span>])) <span class="sc">%&gt;%</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">'ADM1_EN'</span> <span class="ot">=</span> <span class="st">'province_en'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'province_en'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>thailand_esa_drug</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 462 × 4
   ADM1_EN       fiscal_year total_use_cases total_trafficking_cases
   &lt;chr&gt;               &lt;dbl&gt;           &lt;dbl&gt;                   &lt;dbl&gt;
 1 Amnat Charoen        2017            1734                     211
 2 Amnat Charoen        2018            2038                     143
 3 Amnat Charoen        2019            2642                     212
 4 Amnat Charoen        2020             843                     165
 5 Amnat Charoen        2021            3012                     164
 6 Amnat Charoen        2022            1426                      75
 7 Ang Thong            2017             208                      51
 8 Ang Thong            2018             660                      61
 9 Ang Thong            2019             657                      56
10 Ang Thong            2020             423                      46
# ℹ 452 more rows</code></pre>
</div>
</div>
<p>With our data prepared, we can create a <code>spacetime</code> object using the <code>spacetime()</code> function from the <code>sfdep</code> package, with the following as input:</p>
<ul>
<li>Data: <code>thailand_esa_drug</code></li>
<li>Geometry: <code>thailand</code></li>
<li>Location identifier: <code>ADM1_EN</code> (from both <code>thailand_esa_drug</code> and <code>thailand</code>)</li>
<li>Time column: <code>fiscal_year</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>thailand_drug_spt <span class="ot">&lt;-</span> <span class="fu">spacetime</span>(thailand_esa_drug, thailand, <span class="at">.loc_col =</span> <span class="st">"ADM1_EN"</span>, <span class="at">.time_col =</span> <span class="st">"fiscal_year"</span>, <span class="at">active =</span> <span class="st">"data"</span>)</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="fu">is_spacetime_cube</span>(thailand_drug_spt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
<section id="th2.9.2-performing-ehsa" class="level3">
<h3 class="anchored" data-anchor-id="th2.9.2-performing-ehsa">TH2.9.2 Performing EHSA</h3>
<p>We can now perform EHSA analysis using <code>emerging_hotspot_analysis()</code> from the <code>sfdep</code> package. It takes a spacetime object and the name of the variable of interest (<code>.var</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>thailand_ehsa_use <span class="ot">&lt;-</span> <span class="fu">emerging_hotspot_analysis</span>(<span class="at">x =</span> thailand_drug_spt, <span class="at">.var =</span> <span class="st">"total_use_cases"</span>, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">nsim =</span> <span class="dv">99</span>)</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>thailand_ehsa_tr <span class="ot">&lt;-</span> <span class="fu">emerging_hotspot_analysis</span>(<span class="at">x =</span> thailand_drug_spt, <span class="at">.var =</span> <span class="st">"total_trafficking_cases"</span>, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">nsim =</span> <span class="dv">99</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>thailand_ehsa_use <span class="ot">&lt;-</span> thailand <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(thailand_ehsa_use, <span class="at">by =</span> <span class="fu">join_by</span>(ADM1_EN <span class="sc">==</span> location))</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>thailand_ehsa_tr <span class="ot">&lt;-</span> thailand <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(thailand_ehsa_tr, <span class="at">by =</span> <span class="fu">join_by</span>(ADM1_EN <span class="sc">==</span> location))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="th2.9.3-visualising-distribution-of-ehsa-classes" class="level3">
<h3 class="anchored" data-anchor-id="th2.9.3-visualising-distribution-of-ehsa-classes">TH2.9.3 Visualising Distribution of EHSA classes</h3>
<p>The following bar chart reveals the distribution of different EHSA classes per province for both classes of drug offence.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> thailand_ehsa_use, <span class="fu">aes</span>(<span class="at">y =</span> classification, <span class="at">fill =</span> classification)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"EHSA for drug_use"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home-2_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> thailand_ehsa_tr, <span class="fu">aes</span>(<span class="at">y =</span> classification, <span class="at">fill =</span> classification)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"EHSA for drug_trafficking"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home-2_files/figure-html/unnamed-chunk-42-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Based on the plots, thre are a total of 6 distinct hotspot and coldspot classes across both classes of drug offence. However, only the <code>drug_use</code> statistics returned at least one oscilating hotspot, which suggests periodic fluctuations in drug use statistics.</p>
<p>Just as we discovered in the spatial autocorrelation findings from earlier, EHSA on our <code>drug_use</code> statistics returned 20 instances of sporadic coldspots - the highest among provinces where patterns were detected. However, in both instances, more than half of the provinces of Thailand did not feature any pattern.</p>
<p>To check how the findings change when only statistically significant cases are included, we need to isolate only those EHSA classes with <code>p &lt; 0.05</code> for a 95% confidence interval:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>thailand_ehsa_use_sig <span class="ot">&lt;-</span> thailand_ehsa_use <span class="sc">%&gt;%</span> <span class="fu">filter</span>(p_value <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>thailand_ehsa_tr_sig <span class="ot">&lt;-</span> thailand_ehsa_tr <span class="sc">%&gt;%</span> <span class="fu">filter</span>(p_value <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> thailand_ehsa_use_sig, <span class="fu">aes</span>(<span class="at">y =</span> classification, <span class="at">fill =</span> classification)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"EHSA for drug_use with p &lt; 0.05"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home-2_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> thailand_ehsa_tr_sig, <span class="fu">aes</span>(<span class="at">y =</span> classification, <span class="at">fill =</span> classification)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"EHSA for drug_trafficking with p &lt; 0.05"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home-2_files/figure-html/unnamed-chunk-43-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>No statistically significant <code>drug_use</code> EHSA classifications were returned, while there were no new statistically significant hotspots from our <code>drug_trafficking</code> EHSA classifications.</p>
<p>We can try a 90% confidence interval instead for our <code>drug_use</code> EHSA classifications:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>thailand_ehsa_use_sig <span class="ot">&lt;-</span> thailand_ehsa_use <span class="sc">%&gt;%</span> <span class="fu">filter</span>(p_value <span class="sc">&lt;</span> <span class="fl">0.1</span>)</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> thailand_ehsa_use_sig, <span class="fu">aes</span>(<span class="at">y =</span> classification, <span class="at">fill =</span> classification)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"EHSA for drug_use with p &lt; 0.1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home-2_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If we increased our threshold to <code>0.1</code> from <code>0.05</code>, we are able to detect 1 statistically significant oscilating hotspot.</p>
</section>
<section id="th2.9.4-visualising-ehsa-maps" class="level3">
<h3 class="anchored" data-anchor-id="th2.9.4-visualising-ehsa-maps">TH2.9.4 Visualising EHSA Maps</h3>
<p>For this section, we will assume a 95% confidence interval for our <code>drug_trafficking</code> statistics, and ignore statistical significance for our <code>drug_use</code> statistics.</p>
<p>The relevant <code>filter()</code> and <code>tmap</code> functions can be used to create maps that will help us identify the geographic distribution of hotspots and coldspots in our study area.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>thailand_ehsa_use_hot <span class="ot">&lt;-</span> thailand_ehsa_use <span class="sc">%&gt;%</span> <span class="fu">filter</span>(classification <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"consecutive hotspot"</span>,<span class="st">"new hotspot"</span>,<span class="st">"oscilating hotspot"</span>,<span class="st">"sporadic hotspot"</span>))</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>thailand_ehsa_use_cold <span class="ot">&lt;-</span> thailand_ehsa_use <span class="sc">%&gt;%</span> <span class="fu">filter</span>(classification <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"consecutive coldspot"</span>,<span class="st">"oscilating coldspot"</span>,<span class="st">"sporadic coldspot"</span>,<span class="st">"new coldspot"</span>))</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>thailand_ehsa_tr_sig_hot <span class="ot">&lt;-</span> thailand_ehsa_tr_sig <span class="sc">%&gt;%</span> <span class="fu">filter</span>(classification <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"consecutive hotspot"</span>,<span class="st">"new hotspot"</span>,<span class="st">"oscilating hotspot"</span>,<span class="st">"sporadic hotspot"</span>))</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>thailand_ehsa_tr_sig_cold <span class="ot">&lt;-</span> thailand_ehsa_tr_sig <span class="sc">%&gt;%</span> <span class="fu">filter</span>(classification <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"consecutive coldspot"</span>,<span class="st">"oscilating coldspot"</span>,<span class="st">"sporadic coldspot"</span>,<span class="st">"new coldspot"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>hot_map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand_ehsa_use)<span class="sc">+</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>()<span class="sc">+</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(thailand_ehsa_use_hot)<span class="sc">+</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"classification"</span>, </span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#de573e"</span>,<span class="st">"#f67774"</span>,<span class="st">"#f8b675"</span>,<span class="st">"#f8d673"</span>),</span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"classification"</span>,</span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">midpoint =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"drug_use hotspots in Thailand"</span>,</span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="dv">1</span>,</span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a>cold_map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand_ehsa_use)<span class="sc">+</span></span>
<span id="cb115-17"><a href="#cb115-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>()<span class="sc">+</span></span>
<span id="cb115-18"><a href="#cb115-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb115-19"><a href="#cb115-19" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(thailand_ehsa_use_cold)<span class="sc">+</span></span>
<span id="cb115-20"><a href="#cb115-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"classification"</span>, </span>
<span id="cb115-21"><a href="#cb115-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#57bfc0"</span>,<span class="st">"#b977cb"</span>,<span class="st">"#7977f3"</span>),</span>
<span id="cb115-22"><a href="#cb115-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"classification"</span>,</span>
<span id="cb115-23"><a href="#cb115-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">midpoint =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb115-24"><a href="#cb115-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb115-25"><a href="#cb115-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"drug_use coldspots in Thailand"</span>,</span>
<span id="cb115-26"><a href="#cb115-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb115-27"><a href="#cb115-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="dv">1</span>,</span>
<span id="cb115-28"><a href="#cb115-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.title.size =</span> <span class="fl">1.8</span>,</span>
<span id="cb115-29"><a href="#cb115-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.text.size =</span> <span class="fl">1.3</span>,</span>
<span id="cb115-30"><a href="#cb115-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb115-31"><a href="#cb115-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(hot_map, cold_map, <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One tm layer group has duplicated layer types, which are omitted. To
draw multiple layers of the same type, use multiple layer groups (i.e. specify
tm_shape prior to each of them).
Warning: One tm layer group has duplicated layer types, which are omitted. To
draw multiple layers of the same type, use multiple layer groups (i.e. specify
tm_shape prior to each of them).
Warning: One tm layer group has duplicated layer types, which are omitted. To
draw multiple layers of the same type, use multiple layer groups (i.e. specify
tm_shape prior to each of them).
Warning: One tm layer group has duplicated layer types, which are omitted. To
draw multiple layers of the same type, use multiple layer groups (i.e. specify
tm_shape prior to each of them).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Legend labels were too wide. The labels have been resized to 0.80, 0.61. Increase legend.width (argument of tm_layout) to make the legend wider and therefore the labels larger.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home-2_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>hot_map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand_ehsa_tr)<span class="sc">+</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>()<span class="sc">+</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(thailand_ehsa_tr_sig_hot)<span class="sc">+</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"classification"</span>, </span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#de573e"</span>,<span class="st">"#f67774"</span>,<span class="st">"#f8b675"</span>,<span class="st">"#f8d673"</span>),</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"classification"</span>,</span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">midpoint =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"drug_trafficking hotspots in Thailand"</span>,</span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="dv">1</span>,</span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.title.size =</span> <span class="fl">1.8</span>,</span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.text.size =</span> <span class="fl">1.3</span>,</span>
<span id="cb119-15"><a href="#cb119-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb119-16"><a href="#cb119-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb119-17"><a href="#cb119-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-18"><a href="#cb119-18" aria-hidden="true" tabindex="-1"></a>cold_map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(thailand_ehsa_tr)<span class="sc">+</span></span>
<span id="cb119-19"><a href="#cb119-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>()<span class="sc">+</span></span>
<span id="cb119-20"><a href="#cb119-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb119-21"><a href="#cb119-21" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(thailand_ehsa_tr_sig_cold)<span class="sc">+</span></span>
<span id="cb119-22"><a href="#cb119-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"classification"</span>, </span>
<span id="cb119-23"><a href="#cb119-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#57bfc0"</span>,<span class="st">"#b977cb"</span>,<span class="st">"#7977f3"</span>),</span>
<span id="cb119-24"><a href="#cb119-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"classification"</span>,</span>
<span id="cb119-25"><a href="#cb119-25" aria-hidden="true" tabindex="-1"></a>          <span class="at">midpoint =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb119-26"><a href="#cb119-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb119-27"><a href="#cb119-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"drug_trafficking coldspots in Thailand"</span>,</span>
<span id="cb119-28"><a href="#cb119-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb119-29"><a href="#cb119-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="dv">1</span>,</span>
<span id="cb119-30"><a href="#cb119-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.title.size =</span> <span class="fl">1.8</span>,</span>
<span id="cb119-31"><a href="#cb119-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.text.size =</span> <span class="fl">1.3</span>,</span>
<span id="cb119-32"><a href="#cb119-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb119-33"><a href="#cb119-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(hot_map, cold_map, <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One tm layer group has duplicated layer types, which are omitted. To
draw multiple layers of the same type, use multiple layer groups (i.e. specify
tm_shape prior to each of them).
Warning: One tm layer group has duplicated layer types, which are omitted. To
draw multiple layers of the same type, use multiple layer groups (i.e. specify
tm_shape prior to each of them).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Legend labels were too wide. The labels have been resized to 0.54, 0.64. Increase legend.width (argument of tm_layout) to make the legend wider and therefore the labels larger.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One tm layer group has duplicated layer types, which are omitted. To
draw multiple layers of the same type, use multiple layer groups (i.e. specify
tm_shape prior to each of them).
Warning: One tm layer group has duplicated layer types, which are omitted. To
draw multiple layers of the same type, use multiple layer groups (i.e. specify
tm_shape prior to each of them).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Legend labels were too wide. The labels have been resized to 0.51, 0.80. Increase legend.width (argument of tm_layout) to make the legend wider and therefore the labels larger.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take-home-2_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="th2.10-local-gi-and-mann-kendall-tests" class="level2">
<h2 class="anchored" data-anchor-id="th2.10-local-gi-and-mann-kendall-tests">TH2.10 Local Gi* and Mann-Kendall Tests</h2>
<p>Emerging hotspot analysis combines local Gi* statistics with the Mann-Kendall test.</p>
<p>To calculate spatial-temporal local Gi*, we can use the original spacetime cube we created and the following code chunks.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>thailand_drug_nb <span class="ot">&lt;-</span> thailand_drug_spt <span class="sc">%&gt;%</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">activate</span>(<span class="st">"geometry"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nb =</span> <span class="fu">include_self</span>(<span class="fu">st_contiguity</span>(geometry)),</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">wt =</span> <span class="fu">st_inverse_distance</span>(nb, geometry,</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">scale =</span> <span class="dv">1</span>,</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">alpha =</span> <span class="dv">1</span>),</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">.before =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_nbs</span>(<span class="st">"nb"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_wts</span>(<span class="st">"wt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>! Polygon provided. Using point on surface.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There was 1 warning in `stopifnot()`.
ℹ In argument: `wt = st_inverse_distance(nb, geometry, scale = 1, alpha = 1)`.
Caused by warning in `st_point_on_surface.sfc()`:
! st_point_on_surface may not give correct results for longitude/latitude data</code></pre>
</div>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(thailand_drug_nb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>spacetime ────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Context:`data`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>77 locations `ADM1_EN`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>6 time periods `fiscal_year`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── data context ────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  ADM1_EN         fiscal_year total_use_cases total_trafficking_ca…¹ nb    wt   
  &lt;chr&gt;                 &lt;dbl&gt;           &lt;dbl&gt;                  &lt;dbl&gt; &lt;lis&gt; &lt;lis&gt;
1 Bangkok                2017           11871                    950 &lt;int&gt; &lt;dbl&gt;
2 Samut Prakan           2017             820                    201 &lt;int&gt; &lt;dbl&gt;
3 Nonthaburi             2017             553                    118 &lt;int&gt; &lt;dbl&gt;
4 Pathum Thani           2017             450                     83 &lt;int&gt; &lt;dbl&gt;
5 Phra Nakhon Si…        2017             378                    164 &lt;int&gt; &lt;dbl&gt;
6 Ang Thong              2017             208                     51 &lt;int&gt; &lt;dbl&gt;
# ℹ abbreviated name: ¹​total_trafficking_cases</code></pre>
</div>
</div>
</section>
<section id="th2.11-conclusion" class="level2">
<h2 class="anchored" data-anchor-id="th2.11-conclusion">TH2.11 Conclusion</h2>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ol type="1">
<li>Anselin, L. (1995). Local indicators of spatial association—LISA. Geographical Analysis, 27(2), 93–115. https://doi.org/10.1111/j.1538-4632.1995.tb00338.x</li>
<li>Ho, M. (2024, March 1). Take-Home Exercise 2. https://is415-gaa-matthew-ho.netlify.app/takehomeex/takehomeex2/the2</li>
<li>International Monetary Fund. (2024, April 16). World Economic Outlook Database, April 2024 Edition: Thailand. https://www.imf.org/en/Publications/WEO/weo-database/2024/April</li>
<li>Kam, T. S. (2022). R for Geospatial Data Science and Analytics. https://r4gdsa.netlify.app</li>
<li>Khant, M. N. (2024, February 10). Take-Home Exercise 02: Spatio-Temporal Analysis of Dengue Fever Outbreak in Tainan City, Taiwan. https://is415-geospatial-with-khant.netlify.app/take-home_ex/take-home_ex02/take-home_ex02</li>
<li>Kongjareon, Y., Samoh, N., Peerawaranun, P. et al.&nbsp;Pride-based violence, intoxicated sex and poly-drug use: a vocational school-based study of heterosexual and LGBT students in Bangkok. BMC Psychiatry 22, 148 (2022). https://doi.org/10.1186/s12888-022-03777-7</li>
<li>Kanato, M., Sarasiri, R., &amp; Leyatikul, P. (Eds.). (2022). ASEAN drug monitoring report 2021. ASEAN Narcotics Cooperation Center.</li>
<li>Moraga, P. (2024). Spatial neighbourhood matrices. In Spatial statistics for Data Science: Theory and practice with R (pp.&nbsp;83–94). CRC Press.</li>
<li>Thailand. (n.d.). Hands-Off Cain. Retrieved 23 September 2024, from https://www.handsoffcain.info/bancadati/asia-middle-east-australia-and-oceania/thailand-17000464</li>
<li>Tobler, W. R. (1970). A computer movie simulating urban growth in the Detroit region. Economic Geography (Supplement: Proceedings, International Geographical Union. Commission on Quantitative Methods), 46, 234-240. https://doi.org/10.2307/143141</li>
<li>United Nations Development Programme. (2024, March 13). Human Development Report 2023/2024 (PDF). Retrieved September 23, 2024, from https://hdr.undp.org/sites/default/files/reports/3503/hdr2023-24reporten.pdf</li>
<li>World Bank. (n.d.). Gini index. Retrieved September 23, 2024, from https://www.worldbank.org/en/topic/poverty/brief/gini-index</li>
<li>World Bank Open Data. (n.d.). Unemployment, total (% of total labor force) (national estimate) - Thailand. Retrieved 27 September 2024, from https://data.worldbank.org/indicator/SL.UEM.TOTL.NE.ZS?end=2023&amp;locations=TH</li>
<li>World Drug Day report highlights spike in drug use, increased trafficking | UN News. (2024, June 26). United Nations. https://news.un.org/en/story/2024/06/1151446biggest increase from 1873kg in 2020 to 4520kg in 2021 (Kanato et al., 2022).</li>
</ol>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>