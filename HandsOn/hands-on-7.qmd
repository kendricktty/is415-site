---
title: "HX7: Geographical Segmentation with Spatially Constrained Clustering Techniques"
subtitle: "Hands-On Exercise 7"
author: "Kendrick Teo"
date: "2024-10-10"
date-modified: "last-modified"

execute: 
  eval: true
  echo: true
  freeze: true
---

## HX7.1 Overview and Analytical Question

This hands-on exercise is on delineating a homogeneous region using geographically-referenced multivariate data. Today, we return to [Myanmar](https://en.wikipedia.org/wiki/Myanmar) to divide the state of Shan into homogeneous regions using a key statistic: whether the population uses info-communication technologies like mobile phones and computers at home.

## HX7.2 Installing and loading R packages and Data

Today's R packages to be used are:

* Spatial data handling
  * sf, rgdal and spdep
* Attribute data handling
  * tidyverse, especially readr, ggplot2 and dplyr
* Choropleth mapping
  * tmap
* Multivariate data visualisation and analysis
  * coorplot, ggpubr, and heatmaply
* Cluster analysis
  * cluster
* ClustGeo

Today's dataset will be `Shan-ICT.csv`, an extract from the [2014 Myanmar Population and Housing Census](https://myanmar.unfpa.org/en/publications/2014-population-and-housing-census-myanmar-data-sheet) containing, as its name suggests, data on ICT use. We will superimpose this against township boundary data (admin 3) in Myanmar.

```{r}
pacman::p_load(spdep, tmap, sf, ClustGeo, 
               ggpubr, cluster, factoextra, NbClust,
               heatmaply, corrplot, psych, tidyverse, GGally)
shan_sf <- st_read(dsn = "data/geospatial", 
                   layer = "myanmar_township_boundaries") %>%
  # Filter only boundaries of Shan state
  filter(ST %in% c("Shan (East)", "Shan (North)", "Shan (South)")) %>%
  select(c(2:7))
ict <- read_csv ("data/aspatial/Shan-ICT.csv")
summary(ict)
```

## HX7.3 Data Preparation

If we directly use the measurement of the number of households, we may lead to biased data. In general, townships with relatively higher total numbers of households will also lead to higher number of households owning ICT devices. To overcome this problem, we will need to derive the penetration rate of each ICT variable as below.

```{r}
ict_derived <- ict %>%
  mutate(`RADIO_PR` = `Radio`/`Total households`*1000) %>%
  mutate(`TV_PR` = `Television`/`Total households`*1000) %>%
  mutate(`LLPHONE_PR` = `Land line phone`/`Total households`*1000) %>%
  mutate(`MPHONE_PR` = `Mobile phone`/`Total households`*1000) %>%
  mutate(`COMPUTER_PR` = `Computer`/`Total households`*1000) %>%
  mutate(`INTERNET_PR` = `Internet at home`/`Total households`*1000) %>%
  rename(`DT_PCODE` =`District Pcode`,`DT`=`District Name`,
         `TS_PCODE`=`Township Pcode`, `TS`=`Township Name`,
         `TT_HOUSEHOLDS`=`Total households`,
         `RADIO`=`Radio`, `TV`=`Television`, 
         `LLPHONE`=`Land line phone`, `MPHONE`=`Mobile phone`,
         `COMPUTER`=`Computer`, `INTERNET`=`Internet at home`)
summary(ict_derived)
```

## HX7.4 Exploratory Data Analysis

### HX7.4.1 Graphical

The following code chunk plots the distribution of the ownership of various ICT devices in the state. A histogram is useful to identify the overall distribution of data, while a boxplot helps us detect outliers.

```{r}
ggplot(data=ict_derived, 
       aes(x=`RADIO`)) +
  geom_histogram(bins=20, 
                 color="black", 
                 fill="lightgreen")
ggplot(data=ict_derived, 
       aes(x=`RADIO`)) +
  geom_boxplot(color="black", 
               fill="light blue")
```
As we can expect from a not-so-developed country like Myanmar, the ownership of radios is skewed left, i.e. not a lot of the population owns a radio.

We can also plot the distribution of our derived variables, i.e. the penetration rate.

```{r}
ggplot(data=ict_derived, 
       aes(x=`RADIO_PR`)) +
  geom_histogram(bins=20, 
                 color="black", 
                 fill="light blue")
ggplot(data=ict_derived, 
       aes(x=`RADIO_PR`)) +
  geom_boxplot(color="black", 
               fill="light blue")
```
When penetration rate, rather than absolute numbers, is plotted, we can see a much more normalised distribution. The average radio penetration rate in Shan state would lie somewhere around `230-240`.

We can do the same for multiple variables and create multiple plots side by side.

```{r}
radio <- ggplot(data=ict_derived, 
             aes(x= `RADIO_PR`)) +
  geom_histogram(bins=20, 
                 color="black", 
                 fill="light blue")

tv <- ggplot(data=ict_derived, 
             aes(x= `TV_PR`)) +
  geom_histogram(bins=20, 
                 color="black", 
                 fill="light blue")

llphone <- ggplot(data=ict_derived, 
             aes(x= `LLPHONE_PR`)) +
  geom_histogram(bins=20, 
                 color="black", 
                 fill="light blue")

mphone <- ggplot(data=ict_derived, 
             aes(x= `MPHONE_PR`)) +
  geom_histogram(bins=20, 
                 color="black", 
                 fill="light blue")

computer <- ggplot(data=ict_derived, 
             aes(x= `COMPUTER_PR`)) +
  geom_histogram(bins=20, 
                 color="black", 
                 fill="light blue")

internet <- ggplot(data=ict_derived, 
             aes(x= `INTERNET_PR`)) +
  geom_histogram(bins=20, 
                 color="black", 
                 fill="light blue")
ggarrange(radio, tv, llphone, mphone, computer, internet, 
          ncol = 3, 
          nrow = 2)
```

### HX7.4.2 Using choropleth maps

EDA can also be performed by drawing choropleth maps.